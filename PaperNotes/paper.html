<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ç¬”è®°</title>
    <script>
        window.MathJax = {
            tex: {
                inlineMath: [['$', '$'], ['\\(', '\\)']],
                displayMath: [['$$', '$$'], ['\\[', '\\]']],
                processEscapes: true,
                processEnvironments: true,
                packages: {'[+]': ['base', 'ams', 'newcommand', 'configmacros', 'action', 'bbox', 'boldsymbol', 'braket', 'cancel', 'color', 'enclose', 'mhchem', 'physics', 'upgreek', 'unicode', 'verb', 'colorv2']},
                tags: 'ams',
                tagSide: 'right',
                tagIndent: '0.8em',
                multlineWidth: '85%',
                useLabelIds: true,
                macros: {
                    // å¸¸ç”¨æ•°å­¦ç¬¦å·
                    RR: "\\mathbb{R}",
                    NN: "\\mathbb{N}",
                    ZZ: "\\mathbb{Z}",
                    QQ: "\\mathbb{Q}",
                    CC: "\\mathbb{C}",
                    // å‘é‡å’ŒçŸ©é˜µ
                    bm: ["\\boldsymbol{#1}", 1],
                    vec: ["\\mathbf{#1}", 1],
                    mat: ["\\mathbf{#1}", 1],
                    // å¾®ç§¯åˆ†
                    dd: "\\mathrm{d}",
                    diff: ["\\frac{\\mathrm{d}#1}{\\mathrm{d}#2}", 2],
                    pdiff: ["\\frac{\\partial #1}{\\partial #2}", 2],
                    // æ¦‚ç‡ç»Ÿè®¡
                    EE: "\\mathbb{E}",
                    PP: "\\mathbb{P}",
                    Var: "\\mathrm{Var}",
                    Cov: "\\mathrm{Cov}",
                    // å…¶ä»–å¸¸ç”¨
                    argmax: "\\operatorname*{arg\\,max}",
                    argmin: "\\operatorname*{arg\\,min}",
                    // æœºå™¨å­¦ä¹ ç›¸å…³
                    loss: "\\mathcal{L}",
                    data: "\\mathcal{D}",
                    model: "\\mathcal{M}"
                }
            },
            svg: {
                fontCache: 'global',
                displayAlign: 'left',
                displayIndent: '2em'
            },
            loader: {
                load: ['[tex]/color', '[tex]/bbox', '[tex]/colorv2']
            },
            options: {
                skipHtmlTags: ['script', 'noscript', 'style', 'textarea', 'pre', 'code'],
                ignoreHtmlClass: 'tex2jax_ignore',
                processHtmlClass: 'tex2jax_process'
            },
            startup: {
                pageReady: () => {
                    return MathJax.startup.defaultPageReady();
                }
            }
        };
    </script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/3.2.2/es5/tex-mml-chtml.min.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        :root {
            --ghibli-sky: #87CEEB;
            --ghibli-grass: #90C695;
            --ghibli-warm: #F4E4C1;
            --ghibli-sunset: #FFB88C;
            --ghibli-forest: #6B8E6F;
            --ghibli-ocean: #5FA8D3;
            --ghibli-lavender: #CDB4DB;
            --ghibli-peach: #FFD6BA;
            --ghibli-mint: #B7E4C7;
            --ghibli-sage: #95B8A4;
            --shadow: rgba(0, 0, 0, 0.1);
            --text-dark: #2C3E50;
            --text-light: #5D6D7E;
        }

        body {
            font-family: 'Segoe UI', -apple-system, BlinkMacSystemFont, 'Microsoft YaHei', sans-serif;
            background: linear-gradient(135deg, var(--ghibli-sky) 0%, var(--ghibli-warm) 100%);
            min-height: 100vh;
            padding: 20px;
            color: var(--text-dark);
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            background: white;
            border-radius: 16px;
            box-shadow: 0 8px 32px var(--shadow);
            overflow: hidden;
            min-height: 80vh;
        }

        /* Header */
        .header {
            background: linear-gradient(135deg, var(--ghibli-ocean) 0%, var(--ghibli-forest) 100%);
            padding: 24px 32px;
            color: white;
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
        }

        .header h1 {
            font-size: 28px;
            font-weight: 600;
            letter-spacing: 0.5px;
        }

        .breadcrumb {
            display: flex;
            align-items: center;
            gap: 8px;
            font-size: 14px;
            opacity: 0.9;
            margin-top: 8px;
        }

        .breadcrumb-item {
            cursor: pointer;
            transition: opacity 0.2s;
        }

        .breadcrumb-item:hover {
            opacity: 0.7;
            text-decoration: underline;
        }

        .breadcrumb-separator {
            opacity: 0.6;
        }

        /* Buttons */
        .btn {
            padding: 8px 8px;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            font-size: 14px;
            font-weight: 500;
            transition: all 0.3s;
            display: inline-flex;
            align-items: center;
            gap: 6px;
        }

        .btn-primary {
            background: linear-gradient(135deg, var(--ghibli-ocean) 0%, var(--ghibli-lavender) 100%);
            color: white;
        }

        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px var(--shadow);
        }

        .btn-secondary {
            background: var(--ghibli-mint);
            color: var(--text-dark);
        }

        .btn-danger {
            background: var(--ghibli-sunset);
            color: white;
        }

        .btn-group {
            display: flex;
            gap: 12px;
            align-items: center;
            flex-wrap: wrap;
        }

        .header .btn-group {
            margin-top: 36px;
            align-self: flex-start;
        }

        /* Content Area */
        .content {
            padding: 32px;
        }

        /* Level Grid */
        .level-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(280px, 1fr));
            gap: 20px;
            margin-top: 24px;
        }

        .level-card {
            background: linear-gradient(135deg, var(--ghibli-peach) 0%, var(--ghibli-lavender) 100%);
            padding: 24px;
            border-radius: 12px;
            cursor: pointer;
            transition: all 0.3s;
            box-shadow: 0 2px 8px var(--shadow);
        }

        .level-card:hover {
            transform: translateY(-4px);
            box-shadow: 0 6px 20px var(--shadow);
        }

        .level-card h3 {
            font-size: 18px;
            margin-bottom: 8px;
            color: var(--text-dark);
        }

        .level-card .count {
            font-size: 14px;
            color: var(--text-light);
        }

        /* Paper List */
        .paper-item {
            margin-bottom: 16px;
            border-radius: 12px;
            overflow: hidden;
            box-shadow: 0 2px 8px var(--shadow);
            cursor: pointer;
            transition: all 0.3s;
        }

        .paper-item:hover {
            transform: translateX(4px);
            box-shadow: 0 4px 16px var(--shadow);
        }

        .paper-header {
            background: linear-gradient(135deg, var(--ghibli-mint) 0%, var(--ghibli-sage) 100%);
            padding: 10px 20px;
            display: flex;
            align-items: center;
            gap: 16px;
        }

        .paper-number {
            background: linear-gradient(135deg, #6B8E6F 0%, #5FA8D3 100%);
            color: white;
            width: 20px;
            height: 20px;
            border-radius: 9px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: 700;
            font-size: 15px;
            flex-shrink: 0;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
        }

        .paper-info {
            flex: 1;
            display: flex;
            align-items: baseline;
            gap: 12px;
            flex-wrap: wrap;
        }

        .paper-title {
            font-size: 16px;
            font-weight: 600;
            color: var(--text-dark);
        }

        .paper-meta {
            font-size: 13px;
            color: var(--text-light);
            white-space: nowrap;
        }

        .paper-summary {
            background: linear-gradient(135deg, var(--ghibli-peach) 0%, var(--ghibli-warm) 100%);
            padding: 10px 20px 10px 68px;
            font-size: 14px;
            color: var(--text-light);
            line-height: 1.;
        }

        /* Paper Detail View */
        .paper-detail {
            max-width: 1200px;
            margin: 0 auto;
        }

        .detail-title {
            font-size: 32px;
            font-weight: 700;
            color: var(--text-dark);
            margin-bottom: 16px;
            line-height: 1.3;
        }

        .detail-meta {
            display: flex;
            align-items: center;
            gap: 12px;
            flex-wrap: wrap;
            color: var(--text-dark);
            font-size: 14px;
        }

        .detail-meta-item {
            display: flex;
            align-items: center;
            gap: 6px;
        }

        .header .detail-meta-item {
            display: flex;
            align-items: center;
            gap: 6px;
            color: white;
            font-size: 14px;
        }

        .link-button {
            padding: 8px 8px;
            background: var(--ghibli-ocean);
            color: white;
            text-decoration: none;
            border-radius: 6px;
            font-size: 14px;
            transition: all 0.3s;
        }

        .link-button:hover {
            background: var(--ghibli-forest);
        }

        .detail-content {
            font-size: 14px;
            line-height: 1.7;
            color: var(--text-dark);
            column-count: 2;
            column-gap: 40px;
            column-rule: 1px solid #000;
            text-align: justify;
            hyphens: auto;
            word-break: break-word;
            font-family: 'Times New Roman', 'SimSun', 'å®‹ä½“', serif;
            letter-spacing: 0.02em;
        }

        .detail-content h2 {
            break-inside: avoid;
            column-span: all;
            margin-top: 32px;
            margin-bottom: 16px;
            page-break-after: avoid;
        }

        .detail-content h3 {
            break-inside: avoid;
            margin-top: 20px;
            margin-bottom: 12px;
            page-break-after: avoid;
        }

        .detail-content pre {
            break-inside: avoid;
            margin: 12px 0;
        }

        .detail-content p {
            margin-bottom: 12px;
            text-indent: 2em;
            orphans: 2;
            widows: 2;
        }

        .detail-content ul,
        .detail-content ol {
            margin: 12px 0;
            padding-left: 24px;
        }

        .detail-content li {
            margin-bottom: 6px;
            break-inside: avoid;
            orphans: 2;
            widows: 2;
            line-height: 1.7;
        }

        .detail-content code {
            break-inside: avoid;
        }

        .detail-content img {
            max-width: 100%;
            height: auto;
            display: block;
            margin: 16px auto;
            break-inside: avoid;
        }

        .detail-content h2 {
            font-size: 18px;
            font-weight: 700;
            margin: 32px 0 16px;
            color: var(--text-dark);
            border-left: 4px solid var(--ghibli-ocean);
            padding-left: 12px;
            text-align: left;
            font-family: 'Georgia', 'STSong', 'åæ–‡å®‹ä½“', 'SimSun', 'å®‹ä½“', serif;
            letter-spacing: 0.03em;
        }

        .detail-content h3 {
            font-size: 16px;
            font-weight: 600;
            margin: 20px 0 12px;
            color: var(--text-dark);
            text-align: left;
            font-family: 'Georgia', 'STSong', 'åæ–‡å®‹ä½“', 'SimSun', 'å®‹ä½“', serif;
            letter-spacing: 0.03em;
        }

        .detail-content p {
            margin-bottom: 16px;
        }

        .detail-content ul, .detail-content ol {
            margin: 16px 0;
            padding-left: 32px;
        }

        .detail-content li {
            margin-bottom: 8px;
        }

        .detail-content code {
            background: var(--ghibli-warm);
            padding: 2px 6px;
            border-radius: 4px;
            font-family: 'Consolas', 'Monaco', 'Courier New', monospace;
            font-size: 13px;
        }

        .detail-content pre {
            background: var(--ghibli-warm);
            padding: 16px;
            border-radius: 8px;
            overflow-x: auto;
            margin: 16px 0;
            font-family: 'Consolas', 'Monaco', 'Courier New', monospace;
            font-size: 13px;
            line-height: 1.5;
        }

        /* Modal */
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.5);
            z-index: 1000;
            justify-content: center;
            align-items: center;
            padding: 20px;
        }

        .modal.active {
            display: flex;
        }

        .modal-content {
            background: white;
            border-radius: 16px;
            padding: 32px;
            max-width: 600px;
            width: 100%;
            max-height: 90vh;
            overflow-y: auto;
        }

        .modal-content.fullscreen {
            max-width: none;
            width: calc(100vw - 480px);
            max-height: 100vh;
            height: 100vh;
            border-radius: 0;
            margin: 0;
            padding: 20px 32px;
        }

        .modal-header {
            font-size: 24px;
            font-weight: 600;
            margin-bottom: 24px;
            color: var(--text-dark);
        }

        .form-group {
            margin-bottom: 20px;
        }

        .form-group label {
            display: block;
            margin-bottom: 8px;
            font-weight: 500;
            color: var(--text-dark);
        }

        .form-group input,
        .form-group textarea {
            width: 100%;
            padding: 12px;
            border: 2px solid var(--ghibli-mint);
            border-radius: 8px;
            font-size: 14px;
            font-family: inherit;
            transition: border-color 0.3s;
        }

        .form-group textarea.fullscreen-textarea {
            min-height: calc(100vh - 180px);
            font-family: 'Courier New', monospace;
            font-size: 15px;
            line-height: 1.6;
        }

        .form-group input:focus,
        .form-group textarea:focus {
            outline: none;
            border-color: var(--ghibli-ocean);
        }

        .form-group textarea {
            min-height: 150px;
            resize: vertical;
        }

        /* Empty State */
        .empty-state {
            text-align: center;
            padding: 60px 20px;
            color: var(--text-light);
        }

        .empty-state-icon {
            font-size: 64px;
            margin-bottom: 16px;
            opacity: 0.5;
        }

        .empty-state-text {
            font-size: 18px;
            margin-bottom: 8px;
        }

        .empty-state-subtext {
            font-size: 14px;
        }

        /* Action Bar */
        .action-bar {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 24px;
            padding: 16px;
            background: var(--ghibli-warm);
            border-radius: 12px;
        }

        .search-box {
            flex: 1;
            max-width: 400px;
            position: relative;
        }

        .search-box input {
            width: 100%;
            padding: 10px 40px 10px 16px;
            border: 2px solid transparent;
            border-radius: 8px;
            font-size: 14px;
            background: white;
        }

        .search-box input:focus {
            outline: none;
            border-color: var(--ghibli-ocean);
        }

        /* Sidebar Toolbars */
        .sidebar-toolbar {
            position: fixed;
            top: 0;
            width: 240px;
            height: 100vh;
            background: white;
            box-shadow: 0 0 20px var(--shadow);
            padding: 20px;
            overflow-y: auto;
            z-index: 1001;
            display: none;
            animation: slideIn 0.3s ease;
        }

        .sidebar-toolbar.active {
            display: block;
        }

        .left-sidebar {
            left: 0;
        }

        .right-sidebar {
            right: 0;
        }

        @keyframes slideIn {
            from {
                opacity: 0;
                transform: translateX(-20px);
            }
            to {
                opacity: 1;
                transform: translateX(0);
            }
        }

        .sidebar-header {
            font-size: 18px;
            font-weight: 600;
            color: var(--text-dark);
            margin-bottom: 20px;
            padding-bottom: 10px;
            border-bottom: 2px solid var(--ghibli-mint);
        }

        .toolbar-section {
            margin-bottom: 12px;
            border: 1px solid var(--ghibli-mint);
            border-radius: 8px;
            overflow: hidden;
        }

        .toolbar-label {
            font-size: 14px;
            font-weight: 500;
            color: var(--text-dark);
            padding: 12px;
            background: linear-gradient(135deg, var(--ghibli-mint) 0%, var(--ghibli-sage) 100%);
            cursor: pointer;
            display: flex;
            justify-content: space-between;
            align-items: center;
            transition: all 0.3s;
            user-select: none;
        }

        .toolbar-label:hover {
            background: linear-gradient(135deg, var(--ghibli-sage) 0%, var(--ghibli-mint) 100%);
        }

        .toolbar-label::after {
            content: 'â–¼';
            font-size: 10px;
            transition: transform 0.3s;
        }

        .toolbar-label.collapsed::after {
            transform: rotate(-90deg);
        }

        .toolbar-content {
            padding: 12px;
            background: white;
            max-height: 500px;
            overflow: hidden;
            transition: max-height 0.3s ease, padding 0.3s ease;
        }

        .toolbar-content.collapsed {
            max-height: 0;
            padding: 0 12px;
        }

        .toolbar-buttons {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 6px;
        }

        .toolbar-buttons-vertical {
            display: flex;
            flex-direction: column;
            gap: 8px;
        }

        .tool-btn {
            padding: 8px;
            background: var(--ghibli-warm);
            border: 1px solid var(--ghibli-sage);
            border-radius: 6px;
            cursor: pointer;
            font-size: 16px;
            transition: all 0.2s;
            display: flex;
            align-items: center;
            justify-content: center;
            min-height: 36px;
        }

        .tool-btn:hover {
            background: var(--ghibli-mint);
            transform: translateY(-2px);
            box-shadow: 0 2px 8px var(--shadow);
        }

        .tool-btn-large {
            padding: 10px 12px;
            background: var(--ghibli-peach);
            border: 1px solid var(--ghibli-sage);
            border-radius: 6px;
            cursor: pointer;
            font-size: 13px;
            transition: all 0.2s;
            text-align: left;
            font-family: 'Courier New', monospace;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
        }

        .tool-btn-large:hover {
            background: var(--ghibli-lavender);
            transform: translateY(-2px);
            box-shadow: 0 2px 8px var(--shadow);
        }

        /* Adjust container margin when sidebars are active */
        body.sidebars-active .container {
            margin: 0 260px;
        }

        /* Responsive adjustments */
        @media (max-width: 1400px) {
            body.sidebars-active .container {
                margin: 0 auto;
            }
            
            .sidebar-toolbar {
                width: 200px;
            }
        }

        @media (max-width: 1400px) {
            .modal-content.fullscreen {
                width: calc(100vw - 400px);
            }
        }

        @media (max-width: 768px) {
            .modal-content.fullscreen {
                width: 100vw;
                padding: 20px;
            }
        }

        /* Responsive */
        @media (max-width: 768px) {
            .container {
                border-radius: 0;
            }

            .header {
                padding: 20px;
            }

            .header h1 {
                font-size: 22px;
            }

            .content {
                padding: 20px;
            }

            .level-grid {
                grid-template-columns: 1fr;
            }

            .action-bar {
                flex-direction: column;
                gap: 12px;
                align-items: stretch;
            }

            .search-box {
                max-width: 100%;
            }

            .detail-title {
                font-size: 24px;
            }

            .detail-content {
                column-count: 1;
            }

            .detail-header {
                flex-direction: column;
                align-items: flex-start;
            }
            
            .detail-meta-actions {
                margin-left: 0;
                width: 100%;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <div>
                <h1 id="pageTitle">PaperReading</h1>
                <div class="breadcrumb" id="breadcrumb"></div>
            </div>
            <div class="btn-group">
                <button class="btn btn-secondary" onclick="exportData()">ğŸ“¥ å¯¼å‡º</button>
                <button class="btn btn-secondary" onclick="importData()">ğŸ“¤ å¯¼å…¥</button>
            </div>
        </div>

        <div class="content" id="content"></div>
    </div>

    <!-- Add Paper Modal -->
    <div class="modal" id="addPaperModal">
        <div class="modal-content">
            <div class="modal-header">æ·»åŠ è®ºæ–‡ç¬”è®°</div>
            <form id="addPaperForm">
                <div class="form-group" id="titleGroup">
                    <label>è®ºæ–‡æ ‡é¢˜ *</label>
                    <input type="text" id="paperTitle" required>
                </div>
                <div class="form-group" id="authorsGroup">
                    <label>ä½œè€… *</label>
                    <input type="text" id="paperAuthors" required placeholder="å¤šä¸ªä½œè€…ç”¨é€—å·åˆ†éš”">
                </div>
                <div class="form-group" id="yearGroup">
                    <label>å¹´ä»½ *</label>
                    <input type="number" id="paperYear" required min="1900" max="2100">
                </div>
                <div class="form-group" id="urlGroup">
                    <label>è®ºæ–‡é“¾æ¥</label>
                    <input type="url" id="paperUrl" placeholder="https://...">
                </div>
                <div class="form-group" id="summaryGroup">
                    <label>ä¸€å¥è¯ç®€ä»‹ *</label>
                    <input type="text" id="paperSummary" required>
                </div>
                <div class="form-group" id="notesGroup">
                    <textarea id="paperNotes" placeholder="ä½¿ç”¨ $...$ åŒ…è£¹è¡Œå†…å…¬å¼ï¼Œä½¿ç”¨ $$...$$ åŒ…è£¹å—çº§å…¬å¼"></textarea>
                </div>
                <div class="btn-group">
                    <button type="submit" class="btn btn-primary">âœ“ ä¿å­˜</button>
                    <button type="button" class="btn btn-secondary" onclick="closeModal()">âœ• å–æ¶ˆ</button>
                </div>
            </form>
        </div>
    </div>

    <input type="file" id="importFile" accept=".json" style="display: none;">
    <!-- Left Sidebar Toolbar -->
    <div class="sidebar-toolbar left-sidebar" id="leftSidebar">
        <div class="sidebar-header">å¸¸ç”¨ç¬¦å·</div>
        <div class="toolbar-section">
            <div class="toolbar-label" onclick="toggleSection(this)">å¸Œè…Šå­—æ¯ (å°å†™)</div>
            <div class="toolbar-content">
                <div class="toolbar-buttons">
                    <button class="tool-btn" onclick="insertText('\\alpha')">Î±</button>
                    <button class="tool-btn" onclick="insertText('\\beta')">Î²</button>
                    <button class="tool-btn" onclick="insertText('\\gamma')">Î³</button>
                    <button class="tool-btn" onclick="insertText('\\delta')">Î´</button>
                    <button class="tool-btn" onclick="insertText('\\epsilon')">Îµ</button>
                    <button class="tool-btn" onclick="insertText('\\varepsilon')">Ïµ</button>
                    <button class="tool-btn" onclick="insertText('\\zeta')">Î¶</button>
                    <button class="tool-btn" onclick="insertText('\\eta')">Î·</button>
                    <button class="tool-btn" onclick="insertText('\\theta')">Î¸</button>
                    <button class="tool-btn" onclick="insertText('\\vartheta')">Ï‘</button>
                    <button class="tool-btn" onclick="insertText('\\iota')">Î¹</button>
                    <button class="tool-btn" onclick="insertText('\\kappa')">Îº</button>
                    <button class="tool-btn" onclick="insertText('\\lambda')">Î»</button>
                    <button class="tool-btn" onclick="insertText('\\mu')">Î¼</button>
                    <button class="tool-btn" onclick="insertText('\\nu')">Î½</button>
                    <button class="tool-btn" onclick="insertText('\\xi')">Î¾</button>
                    <button class="tool-btn" onclick="insertText('\\pi')">Ï€</button>
                    <button class="tool-btn" onclick="insertText('\\varpi')">Ï–</button>
                    <button class="tool-btn" onclick="insertText('\\rho')">Ï</button>
                    <button class="tool-btn" onclick="insertText('\\varrho')">Ï±</button>
                    <button class="tool-btn" onclick="insertText('\\sigma')">Ïƒ</button>
                    <button class="tool-btn" onclick="insertText('\\varsigma')">Ï‚</button>
                    <button class="tool-btn" onclick="insertText('\\tau')">Ï„</button>
                    <button class="tool-btn" onclick="insertText('\\upsilon')">Ï…</button>
                    <button class="tool-btn" onclick="insertText('\\phi')">Ï†</button>
                    <button class="tool-btn" onclick="insertText('\\varphi')">Ï•</button>
                    <button class="tool-btn" onclick="insertText('\\chi')">Ï‡</button>
                    <button class="tool-btn" onclick="insertText('\\psi')">Ïˆ</button>
                    <button class="tool-btn" onclick="insertText('\\omega')">Ï‰</button>
                    <button class="tool-btn" onclick="insertText('\\digamma')">Ï</button>
                </div>
            </div>
        </div>
        <div class="toolbar-section">
            <div class="toolbar-label" onclick="toggleSection(this)">å¸Œè…Šå­—æ¯ (å¤§å†™)</div>
            <div class="toolbar-content collapsed">
                <div class="toolbar-buttons">
                    <button class="tool-btn" onclick="insertText('\\Gamma')">Î“</button>
                    <button class="tool-btn" onclick="insertText('\\Delta')">Î”</button>
                    <button class="tool-btn" onclick="insertText('\\Theta')">Î˜</button>
                    <button class="tool-btn" onclick="insertText('\\Lambda')">Î›</button>
                    <button class="tool-btn" onclick="insertText('\\Xi')">Î</button>
                    <button class="tool-btn" onclick="insertText('\\Pi')">Î </button>
                    <button class="tool-btn" onclick="insertText('\\Sigma')">Î£</button>
                    <button class="tool-btn" onclick="insertText('\\Upsilon')">Î¥</button>
                    <button class="tool-btn" onclick="insertText('\\Phi')">Î¦</button>
                    <button class="tool-btn" onclick="insertText('\\Psi')">Î¨</button>
                    <button class="tool-btn" onclick="insertText('\\Omega')">Î©</button>
                </div>
            </div>
        </div>
        <div class="toolbar-section">
            <div class="toolbar-label" onclick="toggleSection(this)">è¿ç®—ç¬¦</div>
            <div class="toolbar-content collapsed">
                <div class="toolbar-buttons">
                    <button class="tool-btn" onclick="insertText('\\sum')">âˆ‘</button>
                    <button class="tool-btn" onclick="insertText('\\prod')">âˆ</button>
                    <button class="tool-btn" onclick="insertText('\\coprod')">âˆ</button>
                    <button class="tool-btn" onclick="insertText('\\int')">âˆ«</button>
                    <button class="tool-btn" onclick="insertText('\\iint')">âˆ¬</button>
                    <button class="tool-btn" onclick="insertText('\\iiint')">âˆ­</button>
                    <button class="tool-btn" onclick="insertText('\\oint')">âˆ®</button>
                    <button class="tool-btn" onclick="insertText('\\nabla')">âˆ‡</button>
                    <button class="tool-btn" onclick="insertText('\\partial')">âˆ‚</button>
                    <button class="tool-btn" onclick="insertText('\\infty')">âˆ</button>
                    <button class="tool-btn" onclick="insertText('\\pm')">Â±</button>
                    <button class="tool-btn" onclick="insertText('\\mp')">âˆ“</button>
                    <button class="tool-btn" onclick="insertText('\\times')">Ã—</button>
                    <button class="tool-btn" onclick="insertText('\\div')">Ã·</button>
                    <button class="tool-btn" onclick="insertText('\\cdot')">Â·</button>
                    <button class="tool-btn" onclick="insertText('\\ast')">âˆ—</button>
                    <button class="tool-btn" onclick="insertText('\\star')">â‹†</button>
                    <button class="tool-btn" onclick="insertText('\\circ')">âˆ˜</button>
                    <button class="tool-btn" onclick="insertText('\\bullet')">â€¢</button>
                    <button class="tool-btn" onclick="insertText('\\oplus')">âŠ•</button>
                    <button class="tool-btn" onclick="insertText('\\ominus')">âŠ–</button>
                    <button class="tool-btn" onclick="insertText('\\otimes')">âŠ—</button>
                    <button class="tool-btn" onclick="insertText('\\oslash')">âŠ˜</button>
                    <button class="tool-btn" onclick="insertText('\\odot')">âŠ™</button>
                    <button class="tool-btn" onclick="insertText('\\bigcup')">â‹ƒ</button>
                    <button class="tool-btn" onclick="insertText('\\bigcap')">â‹‚</button>
                    <button class="tool-btn" onclick="insertText('\\biguplus')">â¨„</button>
                    <button class="tool-btn" onclick="insertText('\\bigsqcup')">â¨†</button>
                </div>
            </div>
        </div>
        <div class="toolbar-section">
            <div class="toolbar-label" onclick="toggleSection(this)">å…³ç³»ç¬¦å·</div>
            <div class="toolbar-content collapsed">
                <div class="toolbar-buttons">
                    <button class="tool-btn" onclick="insertText('\\leq')">â‰¤</button>
                    <button class="tool-btn" onclick="insertText('\\geq')">â‰¥</button>
                    <button class="tool-btn" onclick="insertText('\\ll')">â‰ª</button>
                    <button class="tool-btn" onclick="insertText('\\gg')">â‰«</button>
                    <button class="tool-btn" onclick="insertText('\\neq')">â‰ </button>
                    <button class="tool-btn" onclick="insertText('\\equiv')">â‰¡</button>
                    <button class="tool-btn" onclick="insertText('\\approx')">â‰ˆ</button>
                    <button class="tool-btn" onclick="insertText('\\sim')">âˆ¼</button>
                    <button class="tool-btn" onclick="insertText('\\simeq')">â‰ƒ</button>
                    <button class="tool-btn" onclick="insertText('\\cong')">â‰…</button>
                    <button class="tool-btn" onclick="insertText('\\propto')">âˆ</button>
                    <button class="tool-btn" onclick="insertText('\\in')">âˆˆ</button>
                    <button class="tool-btn" onclick="insertText('\\notin')">âˆ‰</button>
                    <button class="tool-btn" onclick="insertText('\\ni')">âˆ‹</button>
                    <button class="tool-btn" onclick="insertText('\\subset')">âŠ‚</button>
                    <button class="tool-btn" onclick="insertText('\\supset')">âŠƒ</button>
                    <button class="tool-btn" onclick="insertText('\\subseteq')">âŠ†</button>
                    <button class="tool-btn" onclick="insertText('\\supseteq')">âŠ‡</button>
                    <button class="tool-btn" onclick="insertText('\\cap')">âˆ©</button>
                    <button class="tool-btn" onclick="insertText('\\cup')">âˆª</button>
                    <button class="tool-btn" onclick="insertText('\\emptyset')">âˆ…</button>
                    <button class="tool-btn" onclick="insertText('\\varnothing')">âŒ€</button>
                    <button class="tool-btn" onclick="insertText('\\perp')">âŠ¥</button>
                    <button class="tool-btn" onclick="insertText('\\parallel')">âˆ¥</button>
                    <button class="tool-btn" onclick="insertText('\\nparallel')">âˆ¦</button>
                    <button class="tool-btn" onclick="insertText('\\asymp')">â‰</button>
                </div>
            </div>
        </div>
        <div class="toolbar-section">
            <div class="toolbar-label" onclick="toggleSection(this)">ç®­å¤´ç¬¦å·</div>
            <div class="toolbar-content collapsed">
                <div class="toolbar-buttons">
                    <button class="tool-btn" onclick="insertText('\\rightarrow')">â†’</button>
                    <button class="tool-btn" onclick="insertText('\\leftarrow')">â†</button>
                    <button class="tool-btn" onclick="insertText('\\leftrightarrow')">â†”</button>
                    <button class="tool-btn" onclick="insertText('\\Rightarrow')">â‡’</button>
                    <button class="tool-btn" onclick="insertText('\\Leftarrow')">â‡</button>
                    <button class="tool-btn" onclick="insertText('\\Leftrightarrow')">â‡”</button>
                    <button class="tool-btn" onclick="insertText('\\uparrow')">â†‘</button>
                    <button class="tool-btn" onclick="insertText('\\downarrow')">â†“</button>
                    <button class="tool-btn" onclick="insertText('\\updownarrow')">â†•</button>
                    <button class="tool-btn" onclick="insertText('\\Uparrow')">â‡‘</button>
                    <button class="tool-btn" onclick="insertText('\\Downarrow')">â‡“</button>
                    <button class="tool-btn" onclick="insertText('\\Updownarrow')">â‡•</button>
                    <button class="tool-btn" onclick="insertText('\\mapsto')">â†¦</button>
                    <button class="tool-btn" onclick="insertText('\\longrightarrow')">âŸ¶</button>
                    <button class="tool-btn" onclick="insertText('\\longleftarrow')">âŸµ</button>
                    <button class="tool-btn" onclick="insertText('\\longleftrightarrow')">âŸ·</button>
                    <button class="tool-btn" onclick="insertText('\\hookleftarrow')">â†©</button>
                    <button class="tool-btn" onclick="insertText('\\hookrightarrow')">â†ª</button>
                    <button class="tool-btn" onclick="insertText('\\rightharpoonup')">â‡€</button>
                    <button class="tool-btn" onclick="insertText('\\leftharpoonup')">â†¼</button>
                </div>
            </div>
        </div>
        <div class="toolbar-section">
            <div class="toolbar-label" onclick="toggleSection(this)">æ•°å­¦å­—ä½“</div>
            <div class="toolbar-content collapsed">
                <div class="toolbar-buttons-vertical">
                    <button class="tool-btn-large" onclick="insertText('\\mathbb{}')">é»‘æ¿ç²—ä½“ â„</button>
                    <button class="tool-btn-large" onclick="insertText('\\mathcal{}')">èŠ±ä½“ ğ“›</button>
                    <button class="tool-btn-large" onclick="insertText('\\mathbf{}')">ç²—ä½“ ğ€</button>
                    <button class="tool-btn-large" onclick="insertText('\\mathit{}')">æ–œä½“</button>
                    <button class="tool-btn-large" onclick="insertText('\\mathrm{}')">ç½—é©¬ä½“</button>
                    <button class="tool-btn-large" onclick="insertText('\\mathsf{}')">æ— è¡¬çº¿ä½“</button>
                    <button class="tool-btn-large" onclick="insertText('\\mathtt{}')">æ‰“å­—æœºä½“</button>
                    <button class="tool-btn-large" onclick="insertText('\\boldsymbol{}')">ç²—ä½“ç¬¦å·</button>
                </div>
            </div>
        </div>
        <div class="toolbar-section">
            <div class="toolbar-label" onclick="toggleSection(this)">å…¶ä»–ç¬¦å·</div>
            <div class="toolbar-content collapsed">
                <div class="toolbar-buttons">
                    <button class="tool-btn" onclick="insertText('\\forall')">âˆ€</button>
                    <button class="tool-btn" onclick="insertText('\\exists')">âˆƒ</button>
                    <button class="tool-btn" onclick="insertText('\\nexists')">âˆ„</button>
                    <button class="tool-btn" onclick="insertText('\\neg')">Â¬</button>
                    <button class="tool-btn" onclick="insertText('\\land')">âˆ§</button>
                    <button class="tool-btn" onclick="insertText('\\lor')">âˆ¨</button>
                    <button class="tool-btn" onclick="insertText('\\top')">âŠ¤</button>
                    <button class="tool-btn" onclick="insertText('\\bot')">âŠ¥</button>
                    <button class="tool-btn" onclick="insertText('\\angle')">âˆ </button>
                    <button class="tool-btn" onclick="insertText('\\triangle')">â–³</button>
                    <button class="tool-btn" onclick="insertText('\\square')">â–¡</button>
                    <button class="tool-btn" onclick="insertText('\\diamond')">â—‡</button>
                    <button class="tool-btn" onclick="insertText('\\perp')">âŠ¥</button>
                    <button class="tool-btn" onclick="insertText('\\parallel')">âˆ¥</button>
                    <button class="tool-btn" onclick="insertText('\\ell')">â„“</button>
                    <button class="tool-btn" onclick="insertText('\\hbar')">â„</button>
                    <button class="tool-btn" onclick="insertText('\\aleph')">â„µ</button>
                    <button class="tool-btn" onclick="insertText('\\Im')">â„‘</button>
                    <button class="tool-btn" onclick="insertText('\\Re')">â„œ</button>
                    <button class="tool-btn" onclick="insertText('\\wp')">â„˜</button>
                </div>
            </div>
        </div>
        <div class="toolbar-section">
            <div class="toolbar-label" onclick="toggleSection(this)">é€»è¾‘ç¬¦å·</div>
            <div class="toolbar-content collapsed">
                <div class="toolbar-buttons">
                    <button class="tool-btn" onclick="insertText('\\land')">âˆ§</button>
                    <button class="tool-btn" onclick="insertText('\\lor')">âˆ¨</button>
                    <button class="tool-btn" onclick="insertText('\\neg')">Â¬</button>
                    <button class="tool-btn" onclick="insertText('\\implies')">âŸ¹</button>
                    <button class="tool-btn" onclick="insertText('\\iff')">âŸº</button>
                    <button class="tool-btn" onclick="insertText('\\forall')">âˆ€</button>
                    <button class="tool-btn" onclick="insertText('\\exists')">âˆƒ</button>
                    <button class="tool-btn" onclick="insertText('\\nexists')">âˆ„</button>
                    <button class="tool-btn" onclick="insertText('\\therefore')">âˆ´</button>
                    <button class="tool-btn" onclick="insertText('\\because')">âˆµ</button>
                    <button class="tool-btn" onclick="insertText('\\vdash')">âŠ¢</button>
                    <button class="tool-btn" onclick="insertText('\\models')">âŠ¨</button>
                </div>
            </div>
        </div>
        <div class="toolbar-section">
            <div class="toolbar-label" onclick="toggleSection(this)">ç‚¹ä¸çœç•¥å·</div>
            <div class="toolbar-content collapsed">
                <div class="toolbar-buttons">
                    <button class="tool-btn" onclick="insertText('\\cdot')">Â·</button>
                    <button class="tool-btn" onclick="insertText('\\cdots')">â‹¯</button>
                    <button class="tool-btn" onclick="insertText('\\ldots')">â€¦</button>
                    <button class="tool-btn" onclick="insertText('\\vdots')">â‹®</button>
                    <button class="tool-btn" onclick="insertText('\\ddots')">â‹±</button>
                    <button class="tool-btn" onclick="insertText('\\dots')">â€¦</button>
                </div>
            </div>
        </div>
        <div class="toolbar-section">
            <div class="toolbar-label" onclick="toggleSection(this)">ç‰¹æ®Šå­—æ¯</div>
            <div class="toolbar-content collapsed">
                <div class="toolbar-buttons">
                    <button class="tool-btn" onclick="insertText('\\ell')">â„“</button>
                    <button class="tool-btn" onclick="insertText('\\hbar')">â„</button>
                    <button class="tool-btn" onclick="insertText('\\imath')">Ä±</button>
                    <button class="tool-btn" onclick="insertText('\\jmath')">È·</button>
                    <button class="tool-btn" onclick="insertText('\\wp')">â„˜</button>
                    <button class="tool-btn" onclick="insertText('\\aleph')">â„µ</button>
                    <button class="tool-btn" onclick="insertText('\\beth')">â„¶</button>
                    <button class="tool-btn" onclick="insertText('\\gimel')">â„·</button>
                    <button class="tool-btn" onclick="insertText('\\daleth')">â„¸</button>
                    <button class="tool-btn" onclick="insertText('\\Im')">â„‘</button>
                    <button class="tool-btn" onclick="insertText('\\Re')">â„œ</button>
                    <button class="tool-btn" onclick="insertText('\\partial')">âˆ‚</button>
                </div>
            </div>
        </div>
        <div class="toolbar-section">
            <div class="toolbar-label" onclick="toggleSection(this)">ç©ºæ ¼ä¸é—´è·</div>
            <div class="toolbar-content collapsed">
                <div class="toolbar-buttons-vertical">
                    <button class="tool-btn-large" onclick="insertText('\\quad')">ç©ºæ ¼ quad</button>
                    <button class="tool-btn-large" onclick="insertText('\\qquad')">åŒç©ºæ ¼ qquad</button>
                    <button class="tool-btn-large" onclick="insertText('\\,')">å°ç©ºæ ¼ \,</button>
                    <button class="tool-btn-large" onclick="insertText('\\;')">ä¸­ç©ºæ ¼ \;</button>
                    <button class="tool-btn-large" onclick="insertText('\\!')">è´Ÿç©ºæ ¼ \!</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Right Sidebar Toolbar -->
    <div class="sidebar-toolbar right-sidebar" id="rightSidebar">
        <div class="sidebar-header">å¸¸ç”¨æ¨¡æ¿</div>
        <div class="toolbar-section">
            <div class="toolbar-label" onclick="toggleSection(this)">åˆ†æ•°ä¸æ ¹å¼</div>
            <div class="toolbar-content">
                <div class="toolbar-buttons-vertical">
                    <button class="tool-btn-large" onclick="insertText('\\frac{}{}')">åˆ†æ•° \frac{}{}</button>
                    <button class="tool-btn-large" onclick="insertText('\\dfrac{}{}')">å¤§åˆ†æ•° \dfrac{}{}</button>
                    <button class="tool-btn-large" onclick="insertText('\\tfrac{}{}')">å°åˆ†æ•° \tfrac{}{}</button>
                    <button class="tool-btn-large" onclick="insertText('\\sqrt{}')">æ ¹å· \sqrt{}</button>
                    <button class="tool-btn-large" onclick="insertText('\\sqrt[]{}')">næ¬¡æ ¹ \sqrt[]{}</button>
                </div>
            </div>
        </div>
        <div class="toolbar-section">
            <div class="toolbar-label" onclick="toggleSection(this)">ä¸Šä¸‹æ ‡</div>
            <div class="toolbar-content collapsed">
                <div class="toolbar-buttons-vertical">
                    <button class="tool-btn-large" onclick="insertText('^{}')">ä¸Šæ ‡ ^{}</button>
                    <button class="tool-btn-large" onclick="insertText('_{}')">ä¸‹æ ‡ _{}</button>
                    <button class="tool-btn-large" onclick="insertText('^{}_{}')">ä¸Šä¸‹æ ‡ ^{}_{}</button>
                    <button class="tool-btn-large" onclick="insertText('\\overset{}{}')">ä¸Šæ–¹æ ‡æ³¨</button>
                    <button class="tool-btn-large" onclick="insertText('\\underset{}{}')">ä¸‹æ–¹æ ‡æ³¨</button>
                </div>
            </div>
        </div>
        <div class="toolbar-section">
            <div class="toolbar-label" onclick="toggleSection(this)">ç§¯åˆ†ä¸æ±‚å’Œ</div>
            <div class="toolbar-content collapsed">
                <div class="toolbar-buttons-vertical">
                    <button class="tool-btn-large" onclick="insertText('\\int')">ä¸å®šç§¯åˆ† âˆ«</button>
                    <button class="tool-btn-large" onclick="insertText('\\int_{}^{}')">å®šç§¯åˆ†</button>
                    <button class="tool-btn-large" onclick="insertText('\\iint')">äºŒé‡ç§¯åˆ† âˆ¬</button>
                    <button class="tool-btn-large" onclick="insertText('\\iiint')">ä¸‰é‡ç§¯åˆ† âˆ­</button>
                    <button class="tool-btn-large" onclick="insertText('\\oint')">ç¯è·¯ç§¯åˆ† âˆ®</button>
                    <button class="tool-btn-large" onclick="insertText('\\sum_{i=1}^{n}')">æ±‚å’Œ Î£</button>
                    <button class="tool-btn-large" onclick="insertText('\\prod_{i=1}^{n}')">è¿ä¹˜ âˆ</button>
                    <button class="tool-btn-large" onclick="insertText('\\lim_{x \\to \\infty}')">æé™</button>
                    <button class="tool-btn-large" onclick="insertText('\\lim_{x \\to a^+}')">å³æé™</button>
                    <button class="tool-btn-large" onclick="insertText('\\lim_{x \\to a^-}')">å·¦æé™</button>
                    <button class="tool-btn-large" onclick="insertText('\\limsup_{n \\to \\infty}')">ä¸Šæé™</button>
                    <button class="tool-btn-large" onclick="insertText('\\liminf_{n \\to \\infty}')">ä¸‹æé™</button>
                    <button class="tool-btn-large" onclick="insertText('\\sup')">ä¸Šç¡®ç•Œ sup</button>
                    <button class="tool-btn-large" onclick="insertText('\\inf')">ä¸‹ç¡®ç•Œ inf</button>
                    <button class="tool-btn-large" onclick="insertText('\\max')">æœ€å¤§å€¼ max</button>
                    <button class="tool-btn-large" onclick="insertText('\\min')">æœ€å°å€¼ min</button>
                </div>
            </div>
        </div>
        <div class="toolbar-section">
            <div class="toolbar-label" onclick="toggleSection(this)">å¯¼æ•°ä¸å¾®åˆ†</div>
            <div class="toolbar-content collapsed">
                <div class="toolbar-buttons-vertical">
                    <button class="tool-btn-large" onclick="insertText('\\frac{d}{dx}')">å¯¼æ•° d/dx</button>
                    <button class="tool-btn-large" onclick="insertText('\\frac{d^2}{dx^2}')">äºŒé˜¶å¯¼æ•°</button>
                    <button class="tool-btn-large" onclick="insertText('\\frac{\\partial}{\\partial x}')">åå¯¼ âˆ‚/âˆ‚x</button>
                    <button class="tool-btn-large" onclick="insertText('\\frac{\\partial^2}{\\partial x^2}')">äºŒé˜¶åå¯¼</button>
                    <button class="tool-btn-large" onclick="insertText('\\nabla')">æ¢¯åº¦ âˆ‡</button>
                    <button class="tool-btn-large" onclick="insertText('\\mathrm{d}x')">å¾®åˆ† dx</button>
                </div>
            </div>
        </div>
        <div class="toolbar-section">
            <div class="toolbar-label" onclick="toggleSection(this)">çŸ©é˜µ</div>
            <div class="toolbar-content collapsed">
                <div class="toolbar-buttons-vertical">
                    <button class="tool-btn-large" onclick="insertText('\\begin{matrix} & \\\\ & \\end{matrix}')">æ— æ‹¬å·</button>
                    <button class="tool-btn-large" onclick="insertText('\\begin{pmatrix} & \\\\ & \\end{pmatrix}')">åœ†æ‹¬å· ( )</button>
                    <button class="tool-btn-large" onclick="insertText('\\begin{bmatrix} & \\\\ & \\end{bmatrix}')">æ–¹æ‹¬å· [ ]</button>
                    <button class="tool-btn-large" onclick="insertText('\\begin{Bmatrix} & \\\\ & \\end{Bmatrix}')">èŠ±æ‹¬å· { }</button>
                    <button class="tool-btn-large" onclick="insertText('\\begin{vmatrix} & \\\\ & \\end{vmatrix}')">å•ç«–çº¿ | |</button>
                    <button class="tool-btn-large" onclick="insertText('\\begin{Vmatrix} & \\\\ & \\end{Vmatrix}')">åŒç«–çº¿ â€– â€–</button>
                </div>
            </div>
        </div>
        <div class="toolbar-section">
            <div class="toolbar-label" onclick="toggleSection(this)">æ‹¬å·</div>
            <div class="toolbar-content collapsed">
                <div class="toolbar-buttons-vertical">
                    <button class="tool-btn-large" onclick="insertText('\\left( \\right)')">è‡ªé€‚åº”åœ†æ‹¬å·</button>
                    <button class="tool-btn-large" onclick="insertText('\\left[ \\right]')">è‡ªé€‚åº”æ–¹æ‹¬å·</button>
                    <button class="tool-btn-large" onclick="insertText('\\left\\{ \\right\\}')">è‡ªé€‚åº”èŠ±æ‹¬å·</button>
                    <button class="tool-btn-large" onclick="insertText('\\left| \\right|')">è‡ªé€‚åº”ç»å¯¹å€¼</button>
                    <button class="tool-btn-large" onclick="insertText('\\left\\| \\right\\|')">è‡ªé€‚åº”èŒƒæ•°</button>
                    <button class="tool-btn-large" onclick="insertText('\\left\\langle \\right\\rangle')">å°–æ‹¬å· âŸ¨âŸ©</button>
                    <button class="tool-btn-large" onclick="insertText('\\left\\lfloor \\right\\rfloor')">ä¸‹å–æ•´ âŒŠâŒ‹</button>
                    <button class="tool-btn-large" onclick="insertText('\\left\\lceil \\right\\rceil')">ä¸Šå–æ•´ âŒˆâŒ‰</button>
                </div>
            </div>
        </div>
        <div class="toolbar-section">
            <div class="toolbar-label" onclick="toggleSection(this)">å¤šè¡Œå…¬å¼</div>
            <div class="toolbar-content collapsed">
                <div class="toolbar-buttons-vertical">
                    <button class="tool-btn-large" onclick="insertText('$$\n\n$$')">å—çº§å…¬å¼ $$...$$</button>
                    <button class="tool-btn-large" onclick="insertText('$  $')">è¡Œå†…å…¬å¼ $...$</button>
                    <button class="tool-btn-large" onclick="insertText('\\begin{align}\n & = \\\\\n & = \n\\end{align}')">å¯¹é½ align</button>
                    <button class="tool-btn-large" onclick="insertText('\\begin{aligned}\n & = \\\\\n & = \n\\end{aligned}')">å¯¹é½ aligned</button>
                    <button class="tool-btn-large" onclick="insertText('\\begin{cases}\n , & \\\\\n , & \n\\end{cases}')">åˆ†æ®µå‡½æ•°</button>
                    <button class="tool-btn-large" onclick="insertText('\\begin{equation}\n\n\\end{equation}')">ç¼–å·å…¬å¼</button>
                </div>
            </div>
        </div>
        <div class="toolbar-section">
            <div class="toolbar-label" onclick="toggleSection(this)">æ ‡æ³¨ä¸è£…é¥°</div>
            <div class="toolbar-content collapsed">
                <div class="toolbar-buttons-vertical">
                    <button class="tool-btn-large" onclick="insertText('\\hat{}')">å¸½å­ Ã¢</button>
                    <button class="tool-btn-large" onclick="insertText('\\widehat{}')">å®½å¸½å­</button>
                    <button class="tool-btn-large" onclick="insertText('\\bar{}')">æ¨ªçº¿ Ä</button>
                    <button class="tool-btn-large" onclick="insertText('\\overline{}')">ä¸Šåˆ’çº¿</button>
                    <button class="tool-btn-large" onclick="insertText('\\underline{}')">ä¸‹åˆ’çº¿</button>
                    <button class="tool-btn-large" onclick="insertText('\\tilde{}')">æ³¢æµª Ã£</button>
                    <button class="tool-btn-large" onclick="insertText('\\widetilde{}')">å®½æ³¢æµª</button>
                    <button class="tool-btn-large" onclick="insertText('\\vec{}')">å‘é‡ç®­å¤´ â†’</button>
                    <button class="tool-btn-large" onclick="insertText('\\dot{}')">å•ç‚¹ È§</button>
                    <button class="tool-btn-large" onclick="insertText('\\ddot{}')">åŒç‚¹ Ã¤</button>
                    <button class="tool-btn-large" onclick="insertText('\\overbrace{}^{}')">ä¸Šæ‹¬å·</button>
                    <button class="tool-btn-large" onclick="insertText('\\underbrace{}_{}')">ä¸‹æ‹¬å·</button>
                    <button class="tool-btn-large" onclick="insertText('\\cancel{}')">åˆ é™¤çº¿</button>
                    <button class="tool-btn-large" onclick="insertText('\\bcancel{}')">ååˆ é™¤çº¿</button>
                    <button class="tool-btn-large" onclick="insertText('\\xcancel{}')">äº¤å‰åˆ é™¤</button>
                </div>
            </div>
        </div>
        <div class="toolbar-section">
            <div class="toolbar-label" onclick="toggleSection(this)">å¸¸ç”¨æ•°é›†</div>
            <div class="toolbar-content collapsed">
                <div class="toolbar-buttons-vertical">
                    <button class="tool-btn-large" onclick="insertText('\\mathbb{R}')">å®æ•°é›† â„</button>
                    <button class="tool-btn-large" onclick="insertText('\\mathbb{C}')">å¤æ•°é›† â„‚</button>
                    <button class="tool-btn-large" onclick="insertText('\\mathbb{Z}')">æ•´æ•°é›† â„¤</button>
                    <button class="tool-btn-large" onclick="insertText('\\mathbb{Q}')">æœ‰ç†æ•°é›† â„š</button>
                    <button class="tool-btn-large" onclick="insertText('\\mathbb{N}')">è‡ªç„¶æ•°é›† â„•</button>
                    <button class="tool-btn-large" onclick="insertText('\\mathbb{P}')">ç´ æ•°é›† â„™</button>
                    <button class="tool-btn-large" onclick="insertText('\\mathbb{H}')">å››å…ƒæ•° â„</button>
                    <button class="tool-btn-large" onclick="insertText('\\mathbb{F}')">åŸŸ ğ”½</button>
                </div>
            </div>
        </div>
        <div class="toolbar-section">
            <div class="toolbar-label" onclick="toggleSection(this)">æ¦‚ç‡ç»Ÿè®¡</div>
            <div class="toolbar-content collapsed">
                <div class="toolbar-buttons-vertical">
                    <button class="tool-btn-large" onclick="insertText('\\mathbb{E}[]')">æœŸæœ› ğ”¼</button>
                    <button class="tool-btn-large" onclick="insertText('\\mathbb{P}()') ">æ¦‚ç‡ â„™</button>
                    <button class="tool-btn-large" onclick="insertText('\\mathrm{Var}[]')">æ–¹å·® Var</button>
                    <button class="tool-btn-large" onclick="insertText('\\mathrm{Cov}(,)')">åæ–¹å·® Cov</button>
                    <button class="tool-btn-large" onclick="insertText('\\sim')">æœä»åˆ†å¸ƒ âˆ¼</button>
                    <button class="tool-btn-large" onclick="insertText('\\mathcal{N}(,)')">æ­£æ€åˆ†å¸ƒ ğ’©</button>
                    <button class="tool-btn-large" onclick="insertText('P(|)')">æ¡ä»¶æ¦‚ç‡</button>
                </div>
            </div>
        </div>
        <div class="toolbar-section">
            <div class="toolbar-label" onclick="toggleSection(this)">ä¸‰è§’å‡½æ•°</div>
            <div class="toolbar-content collapsed">
                <div class="toolbar-buttons-vertical">
                    <button class="tool-btn-large" onclick="insertText('\\sin')">sin</button>
                    <button class="tool-btn-large" onclick="insertText('\\cos')">cos</button>
                    <button class="tool-btn-large" onclick="insertText('\\tan')">tan</button>
                    <button class="tool-btn-large" onclick="insertText('\\cot')">cot</button>
                    <button class="tool-btn-large" onclick="insertText('\\sec')">sec</button>
                    <button class="tool-btn-large" onclick="insertText('\\csc')">csc</button>
                    <button class="tool-btn-large" onclick="insertText('\\arcsin')">arcsin</button>
                    <button class="tool-btn-large" onclick="insertText('\\arccos')">arccos</button>
                    <button class="tool-btn-large" onclick="insertText('\\arctan')">arctan</button>
                    <button class="tool-btn-large" onclick="insertText('\\sinh')">sinh</button>
                    <button class="tool-btn-large" onclick="insertText('\\cosh')">cosh</button>
                    <button class="tool-btn-large" onclick="insertText('\\tanh')">tanh</button>
                </div>
            </div>
        </div>
        <div class="toolbar-section">
            <div class="toolbar-label" onclick="toggleSection(this)">æœºå™¨å­¦ä¹ </div>
            <div class="toolbar-content collapsed">
                <div class="toolbar-buttons-vertical">
                    <button class="tool-btn-large" onclick="insertText('\\mathcal{L}')">æŸå¤±å‡½æ•° ğ“›</button>
                    <button class="tool-btn-large" onclick="insertText('\\mathcal{D}')">æ•°æ®é›† ğ““</button>
                    <button class="tool-btn-large" onclick="insertText('\\mathcal{H}')">å‡è®¾ç©ºé—´ ğ“—</button>
                    <button class="tool-btn-large" onclick="insertText('\\theta')">å‚æ•° Î¸</button>
                    <button class="tool-btn-large" onclick="insertText('\\nabla_{\\theta}')">æ¢¯åº¦ âˆ‡Î¸</button>
                    <button class="tool-btn-large" onclick="insertText('\\argmax_{}')">argmax</button>
                    <button class="tool-btn-large" onclick="insertText('\\argmin_{}')">argmin</button>
                    <button class="tool-btn-large" onclick="insertText('\\hat{y}')">é¢„æµ‹å€¼ Å·</button>
                    <button class="tool-btn-large" onclick="insertText('\\mathbf{x}')">å‘é‡ ğ±</button>
                    <button class="tool-btn-large" onclick="insertText('\\mathbf{W}')">çŸ©é˜µ ğ–</button>
                </div>
            </div>
        </div>
        <div class="toolbar-section">
            <div class="toolbar-label" onclick="toggleSection(this)">Markdownæ ¼å¼</div>
            <div class="toolbar-content collapsed">
                <div class="toolbar-buttons-vertical">
                    <button class="tool-btn-large" onclick="insertText('## ')">äºŒçº§æ ‡é¢˜</button>
                    <button class="tool-btn-large" onclick="insertText('### ')">ä¸‰çº§æ ‡é¢˜</button>
                    <button class="tool-btn-large" onclick="insertText('**  **')">ç²—ä½“</button>
                    <button class="tool-btn-large" onclick="insertText('*  *')">æ–œä½“</button>
                    <button class="tool-btn-large" onclick="insertText('`  `')">è¡Œå†…ä»£ç </button>
                    <button class="tool-btn-large" onclick="insertText('```\n\n```')">ä»£ç å—</button>
                    <button class="tool-btn-large" onclick="insertText('- ')">æ— åºåˆ—è¡¨</button>
                    <button class="tool-btn-large" onclick="insertText('1. ')">æœ‰åºåˆ—è¡¨</button>
                </div>
            </div>
        </div>
        <div class="toolbar-section">
            <div class="toolbar-label" onclick="toggleSection(this)">æ·±åº¦å­¦ä¹ </div>
            <div class="toolbar-content collapsed">
                <div class="toolbar-buttons-vertical">
                    <button class="tool-btn-large" onclick="insertText('\\text{softmax}(\\mathbf{z})')">softmax</button>
                    <button class="tool-btn-large" onclick="insertText('\\text{ReLU}(x) = \\max(0, x)')">ReLU</button>
                    <button class="tool-btn-large" onclick="insertText('\\sigma(x) = \\frac{1}{1+e^{-x}}')">sigmoid</button>
                    <button class="tool-btn-large" onclick="insertText('\\tanh(x)')">tanh</button>
                    <button class="tool-btn-large" onclick="insertText('\\text{Attention}(Q,K,V)')">Attention</button>
                    <button class="tool-btn-large" onclick="insertText('\\mathbf{h}_t = \\text{LSTM}(\\mathbf{x}_t, \\mathbf{h}_{t-1})')">LSTM</button>
                    <button class="tool-btn-large" onclick="insertText('\\mathbf{W} \\mathbf{x} + \\mathbf{b}')">çº¿æ€§å±‚</button>
                    <button class="tool-btn-large" onclick="insertText('\\text{BatchNorm}(\\mathbf{x})')">BatchNorm</button>
                </div>
            </div>
        </div>
        <div class="toolbar-section">
            <div class="toolbar-label" onclick="toggleSection(this)">ä¼˜åŒ–ç®—æ³•</div>
            <div class="toolbar-content collapsed">
                <div class="toolbar-buttons-vertical">
                    <button class="tool-btn-large" onclick="insertText('\\theta_{t+1} = \\theta_t - \\eta \\nabla_{\\theta} \\mathcal{L}')">SGD</button>
                    <button class="tool-btn-large" onclick="insertText('m_t = \\beta_1 m_{t-1} + (1-\\beta_1) g_t')">åŠ¨é‡é¡¹</button>
                    <button class="tool-btn-large" onclick="insertText('\\text{Adam: } \\theta_t = \\theta_{t-1} - \\alpha \\frac{\\hat{m}_t}{\\sqrt{\\hat{v}_t} + \\epsilon}')">Adam</button>
                    <button class="tool-btn-large" onclick="insertText('\\eta_t = \\eta_0 \\cdot \\frac{1}{\\sqrt{t}}')">å­¦ä¹ ç‡è¡°å‡</button>
                </div>
            </div>
        </div>
        <div class="toolbar-section">
            <div class="toolbar-label" onclick="toggleSection(this)">å¸¸è§æŸå¤±å‡½æ•°</div>
            <div class="toolbar-content collapsed">
                <div class="toolbar-buttons-vertical">
                    <button class="tool-btn-large" onclick="insertText('\\text{MSE} = \\frac{1}{n} \\sum_{i=1}^n (y_i - \\hat{y}_i)^2')">MSE</button>
                    <button class="tool-btn-large" onclick="insertText('\\text{CrossEntropy} = -\\sum_{i} y_i \\log(\\hat{y}_i)')">äº¤å‰ç†µ</button>
                    <button class="tool-btn-large" onclick="insertText('\\text{KL}(P||Q) = \\sum_i P(i) \\log \\frac{P(i)}{Q(i)}')">KLæ•£åº¦</button>
                    <button class="tool-btn-large" onclick="insertText('\\text{Hinge} = \\max(0, 1 - y \\cdot \\hat{y})')">Hinge Loss</button>
                    <button class="tool-btn-large" onclick="insertText('||\\mathbf{x} - \\mathbf{y}||_2^2')">L2 Loss</button>
                </div>
            </div>
        </div>
        <div class="toolbar-section">
            <div class="toolbar-label" onclick="toggleSection(this)">ä¿¡æ¯è®º</div>
            <div class="toolbar-content collapsed">
                <div class="toolbar-buttons-vertical">
                    <button class="tool-btn-large" onclick="insertText('H(X) = -\\sum_{x} p(x) \\log p(x)')">ç†µ Entropy</button>
                    <button class="tool-btn-large" onclick="insertText('I(X;Y) = H(X) - H(X|Y)')">äº’ä¿¡æ¯</button>
                    <button class="tool-btn-large" onclick="insertText('H(X|Y)')">æ¡ä»¶ç†µ</button>
                    <button class="tool-btn-large" onclick="insertText('D_{KL}(P||Q)')">KLæ•£åº¦</button>
                </div>
            </div>
        </div>
        <div class="toolbar-section">
            <div class="toolbar-label" onclick="toggleSection(this)">çº¿æ€§ä»£æ•°</div>
            <div class="toolbar-content collapsed">
                <div class="toolbar-buttons-vertical">
                    <button class="tool-btn-large" onclick="insertText('\\mathbf{A}^T')">è½¬ç½® Aáµ€</button>
                    <button class="tool-btn-large" onclick="insertText('\\mathbf{A}^{-1}')">é€†çŸ©é˜µ Aâ»Â¹</button>
                    <button class="tool-btn-large" onclick="insertText('\\det(\\mathbf{A})')">è¡Œåˆ—å¼ det</button>
                    <button class="tool-btn-large" onclick="insertText('\\text{tr}(\\mathbf{A})')">è¿¹ trace</button>
                    <button class="tool-btn-large" onclick="insertText('\\text{rank}(\\mathbf{A})')">ç§© rank</button>
                    <button class="tool-btn-large" onclick="insertText('||\\mathbf{x}||_2')">2-èŒƒæ•°</button>
                    <button class="tool-btn-large" onclick="insertText('||\\mathbf{x}||_1')">1-èŒƒæ•°</button>
                    <button class="tool-btn-large" onclick="insertText('||\\mathbf{x}||_\\infty')">âˆ-èŒƒæ•°</button>
                    <button class="tool-btn-large" onclick="insertText('\\langle \\mathbf{x}, \\mathbf{y} \\rangle')">å†…ç§¯</button>
                    <button class="tool-btn-large" onclick="insertText('\\mathbf{x} \\otimes \\mathbf{y}')">å¤–ç§¯/å¼ é‡ç§¯</button>
                    <button class="tool-btn-large" onclick="insertText('\\mathbf{A} \\odot \\mathbf{B}')">Hadamardç§¯</button>
                    <button class="tool-btn-large" onclick="insertText('\\lambda_i, \\mathbf{v}_i')">ç‰¹å¾å€¼/å‘é‡</button>
                </div>
            </div>
        </div>
        <div class="toolbar-section">
            <div class="toolbar-label" onclick="toggleSection(this)">å¾®ç§¯åˆ†å®šç†</div>
            <div class="toolbar-content collapsed">
                <div class="toolbar-buttons-vertical">
                    <button class="tool-btn-large" onclick="insertText('\\frac{d}{dx}[f(x)g(x)] = f\'(x)g(x) + f(x)g\'(x)')">ä¹˜ç§¯æ³•åˆ™</button>
                    <button class="tool-btn-large" onclick="insertText('\\frac{d}{dx}\\left[\\frac{f(x)}{g(x)}\\right] = \\frac{f\'(x)g(x) - f(x)g\'(x)}{g(x)^2}')">å•†æ³•åˆ™</button>
                    <button class="tool-btn-large" onclick="insertText('\\frac{df(g(x))}{dx} = f\'(g(x)) \\cdot g\'(x)')">é“¾å¼æ³•åˆ™</button>
                    <button class="tool-btn-large" onclick="insertText('\\int_a^b f(x)dx = F(b) - F(a)')">å¾®ç§¯åˆ†åŸºæœ¬å®šç†</button>
                    <button class="tool-btn-large" onclick="insertText('\\int u dv = uv - \\int v du')">åˆ†éƒ¨ç§¯åˆ†</button>
                </div>
            </div>
        </div>
        <div class="toolbar-section">
            <div class="toolbar-label" onclick="toggleSection(this)">å¸¸ç”¨ä¸ç­‰å¼</div>
            <div class="toolbar-content collapsed">
                <div class="toolbar-buttons-vertical">
                    <button class="tool-btn-large" onclick="insertText('|x + y| \\leq |x| + |y|')">ä¸‰è§’ä¸ç­‰å¼</button>
                    <button class="tool-btn-large" onclick="insertText('\\frac{x+y}{2} \\geq \\sqrt{xy}')">ç®—æœ¯-å‡ ä½•å¹³å‡</button>
                    <button class="tool-btn-large" onclick="insertText('|xy| \\leq \\frac{x^2 + y^2}{2}')">æŸ¯è¥¿ä¸ç­‰å¼å½¢å¼</button>
                    <button class="tool-btn-large" onclick="insertText('\\left|\\sum x_i y_i\\right| \\leq \\sqrt{\\sum x_i^2} \\sqrt{\\sum y_i^2}')">æŸ¯è¥¿-æ–½ç“¦èŒ¨</button>
                    <button class="tool-btn-large" onclick="insertText('e^x \\geq 1 + x')">æŒ‡æ•°ä¸ç­‰å¼</button>
                </div>
            </div>
        </div>
        <div class="toolbar-section">
            <div class="toolbar-label" onclick="toggleSection(this)">å¤æ‚å…¬å¼æ¨¡æ¿</div>
            <div class="toolbar-content collapsed">
                <div class="toolbar-buttons-vertical">
                    <button class="tool-btn-large" onclick="insertText('f(x) = \\begin{cases} a, & x < 0 \\\\ b, & x \\geq 0 \\end{cases}')">åˆ†æ®µå‡½æ•°</button>
                    <button class="tool-btn-large" onclick="insertText('\\sum_{i=1}^{n} \\sum_{j=1}^{m}')">åŒé‡æ±‚å’Œ</button>
                    <button class="tool-btn-large" onclick="insertText('\\prod_{i=1}^{n}')">è¿ä¹˜ç¬¦å·</button>
                    <button class="tool-btn-large" onclick="insertText('\\binom{n}{k} = \\frac{n!}{k!(n-k)!}')">äºŒé¡¹å¼ç³»æ•°</button>
                    <button class="tool-btn-large" onclick="insertText('\\left. \\frac{df}{dx} \\right|_{x=a}')">å¯¼æ•°åœ¨æŸç‚¹å€¼</button>
                    <button class="tool-btn-large" onclick="insertText('\\xrightarrow[ä¸‹]{ä¸Š}')">å¸¦æ ‡æ³¨ç®­å¤´</button>
                    <button class="tool-btn-large" onclick="insertText('\\xleftarrow[ä¸‹]{ä¸Š}')">å¸¦æ ‡æ³¨å·¦ç®­å¤´</button>
                    <button class="tool-btn-large" onclick="insertText('\\stackrel{ä¸Š}{=}')">ç­‰å·ä¸Šæ ‡æ³¨</button>
                </div>
            </div>
        </div>
        <div class="toolbar-section">
            <div class="toolbar-label" onclick="toggleSection(this)">é¢œè‰²ä¸é«˜äº®</div>
            <div class="toolbar-content collapsed">
                <div class="toolbar-buttons-vertical">
                    <button class="tool-btn-large" onclick="insertText('\\textcolor{red}{  }')">çº¢è‰²æ–‡æœ¬</button>
                    <button class="tool-btn-large" onclick="insertText('\\textcolor{blue}{  }')">è“è‰²æ–‡æœ¬</button>
                    <button class="tool-btn-large" onclick="insertText('\\textcolor{green}{  }')">ç»¿è‰²æ–‡æœ¬</button>
                    <button class="tool-btn-large" onclick="insertText('\\textcolor{orange}{  }')">æ©™è‰²æ–‡æœ¬</button>
                    <button class="tool-btn-large" onclick="insertText('\\bbox[yellow]{  }')">é»„è‰²èƒŒæ™¯</button>
                    <button class="tool-btn-large" onclick="insertText('\\bbox[lightblue]{  }')">æµ…è“èƒŒæ™¯</button>
                    <button class="tool-btn-large" onclick="insertText('\\bbox[pink]{  }')">ç²‰è‰²èƒŒæ™¯</button>
                    <button class="tool-btn-large" onclick="insertText('\\bbox[lightgreen]{  }')">æµ…ç»¿èƒŒæ™¯</button>
                    <button class="tool-btn-large" onclick="insertText('\\bbox[yellow,5px]{  }')">é»„è‰²èƒŒæ™¯+è¾¹è·</button>
                    <button class="tool-btn-large" onclick="insertText('\\bbox[yellow,5px,border:2px solid red]{  }')">å½©è‰²è¾¹æ¡†</button>
                    <button class="tool-btn-large" onclick="insertText('\\boxed{  }')">æ–¹æ¡†</button>
                </div>
            </div>
        </div>
    </div>

    <script>
        // Data structure
        const structure = {
            "ä¸€ï¼šåŸºç¡€ç†è®ºä¸æ–¹æ³•": {
                "1. æœºå™¨å­¦ä¹ åŸºç¡€": ["1.1 ç›‘ç£å­¦ä¹ ", "1.2 æ— ç›‘ç£å­¦ä¹ ", "1.3 åŠç›‘ç£å­¦ä¹ ", "1.4 è‡ªç›‘ç£å­¦ä¹ ", "1.5 å¼ºåŒ–å­¦ä¹ åŸºç¡€", "1.6 åœ¨çº¿å­¦ä¹ ä¸ä¸»åŠ¨å­¦ä¹ ", "1.7 é›†æˆå­¦ä¹ "],
                "2. æ·±åº¦å­¦ä¹ æ ¸å¿ƒ": ["2.1 ä¼˜åŒ–ç®—æ³•", "2.2 æ­£åˆ™åŒ–æŠ€æœ¯", "2.3 å½’ä¸€åŒ–æ–¹æ³•", "2.4 æ¿€æ´»å‡½æ•°ä¸æŸå¤±å‡½æ•°", "2.5 å­¦ä¹ ç‡è°ƒåº¦", "2.6 æ•°æ®å¢å¼ºç­–ç•¥"],
                "3. ç¥ç»ç½‘ç»œæ¶æ„": ["3.1 å‰é¦ˆç¥ç»ç½‘ç»œ", "3.2 å·ç§¯ç¥ç»ç½‘ç»œ (CNN)", "3.3 å¾ªç¯ç¥ç»ç½‘ç»œ (RNN/LSTM/GRU)", "3.4 Transformeræ¶æ„", "3.5 å›¾ç¥ç»ç½‘ç»œ (GNN)", "3.6 æ³¨æ„åŠ›æœºåˆ¶", "3.7 ç¥ç»æ¶æ„æœç´¢ (NAS)"],
                "4. ç”Ÿæˆæ¨¡å‹": ["4.1 ç”Ÿæˆå¯¹æŠ—ç½‘ç»œ (GAN)", "4.2 å˜åˆ†è‡ªç¼–ç å™¨ (VAE)", "4.3 æ‰©æ•£æ¨¡å‹", "4.4 è‡ªå›å½’æ¨¡å‹", "4.5 æµæ¨¡å‹", "4.6 åŸºäºèƒ½é‡çš„æ¨¡å‹"]
            },
            "äºŒï¼šæ ¸å¿ƒåº”ç”¨é¢†åŸŸ": {
                "5. è®¡ç®—æœºè§†è§‰": ["5.1 å›¾åƒåˆ†ç±»ä¸è¯†åˆ«", "5.2 ç›®æ ‡æ£€æµ‹", "5.3 å›¾åƒåˆ†å‰²", "5.4 ç›®æ ‡è·Ÿè¸ª", "5.5 å§¿æ€ä¼°è®¡", "5.6 ä¸‰ç»´è§†è§‰ä¸åœºæ™¯é‡å»º", "5.7 è§†é¢‘ç†è§£", "5.8 å›¾åƒç”Ÿæˆä¸ç¼–è¾‘", "5.9 å…‰æµä¼°è®¡", "5.10 å›¾åƒå¢å¼º"],
                "6. è‡ªç„¶è¯­è¨€å¤„ç†": ["6.1 è¯åµŒå…¥ä¸è¡¨ç¤ºå­¦ä¹ ", "6.2 é¢„è®­ç»ƒè¯­è¨€æ¨¡å‹", "6.3 å¤§è¯­è¨€æ¨¡å‹ (LLM)", "6.4 æœºå™¨ç¿»è¯‘", "6.5 æ–‡æœ¬ç”Ÿæˆ", "6.6 é—®ç­”ç³»ç»Ÿ", "6.7 å¯¹è¯ç³»ç»Ÿ", "6.8 ä¿¡æ¯æŠ½å–", "6.9 æ–‡æœ¬æ‘˜è¦", "6.10 æƒ…æ„Ÿåˆ†æä¸æ–‡æœ¬åˆ†ç±»", "6.11 è‡ªç„¶è¯­è¨€ç†è§£ä¸æ¨ç†", "6.12 æç¤ºå·¥ç¨‹"],
                "7. å¤šæ¨¡æ€å­¦ä¹ ": ["7.1 è§†è§‰-è¯­è¨€é¢„è®­ç»ƒ", "7.2 å›¾åƒæè¿°ç”Ÿæˆ", "7.3 è§†è§‰é—®ç­” (VQA)", "7.4 æ–‡æœ¬åˆ°å›¾åƒç”Ÿæˆ", "7.5 è§†é¢‘-è¯­è¨€ç†è§£", "7.6 éŸ³é¢‘-è§†è§‰å­¦ä¹ ", "7.7 å¤šæ¨¡æ€å¤§æ¨¡å‹"],
                "8. è¯­éŸ³ä¸éŸ³é¢‘": ["8.1 è¯­éŸ³è¯†åˆ« (ASR)", "8.2 è¯­éŸ³åˆæˆ (TTS)", "8.3 è¯­éŸ³è½¬æ¢", "8.4 è¯­éŸ³å¢å¼º", "8.5 è¯´è¯äººè¯†åˆ«", "8.6 è¯­éŸ³æƒ…æ„Ÿè¯†åˆ«", "8.7 éŸ³ä¹ç”Ÿæˆä¸ç†è§£"],
                "9. å¼ºåŒ–å­¦ä¹ ": ["9.1 å€¼å‡½æ•°æ–¹æ³•", "9.2 ç­–ç•¥æ¢¯åº¦æ–¹æ³•", "9.3 Actor-Criticæ–¹æ³•", "9.4 æ¨¡å‹é¢„æµ‹æ§åˆ¶", "9.5 å¤šæ™ºèƒ½ä½“å¼ºåŒ–å­¦ä¹ ", "9.6 é€†å¼ºåŒ–å­¦ä¹ ä¸æ¨¡ä»¿å­¦ä¹ ", "9.7 ç¦»çº¿å¼ºåŒ–å­¦ä¹ ", "9.8 å±‚æ¬¡å¼ºåŒ–å­¦ä¹ ", "9.9 æ¸¸æˆAIåº”ç”¨"]
            },
            "ä¸‰ï¼šä¸“ä¸šåº”ç”¨åœºæ™¯": {
                "10. åŒ»ç–—AI": ["10.1 åŒ»å­¦å›¾åƒåˆ†æ", "10.2 ç—…ç†å›¾åƒåˆ†æ", "10.3 åŒ»å­¦å½±åƒåˆ†å‰²", "10.4 è¯ç‰©å‘ç°", "10.5 ä¸´åºŠé¢„æµ‹æ¨¡å‹", "10.6 åŸºå› ç»„å­¦"],
                "11. è‡ªåŠ¨é©¾é©¶": ["11.1 æ„ŸçŸ¥ç³»ç»Ÿ", "11.2 å¤šä¼ æ„Ÿå™¨èåˆ", "11.3 ç«¯åˆ°ç«¯é©¾é©¶", "11.4 è¿åŠ¨é¢„æµ‹", "11.5 è·¯å¾„è§„åˆ’", "11.6 åœºæ™¯ç†è§£"],
                "12. æœºå™¨äººå­¦ä¹ ": ["12.1 æœºå™¨äººæ“ä½œ", "12.2 æ¨¡ä»¿å­¦ä¹ ", "12.3 æœºå™¨äººå¯¼èˆª", "12.4 æœºå™¨äººè§†è§‰", "12.5 å¤šæœºå™¨äººåä½œ"],
                "13. æ¨èç³»ç»Ÿ": ["13.1 ååŒè¿‡æ»¤", "13.2 æ·±åº¦æ¨èæ¨¡å‹", "13.3 åºåˆ—æ¨è", "13.4 çŸ¥è¯†å›¾è°±æ¨è", "13.5 å¤šä»»åŠ¡æ¨è"],
                "14. æ—¶é—´åºåˆ—åˆ†æ": ["14.1 æ—¶é—´åºåˆ—é¢„æµ‹", "14.2 å¼‚å¸¸æ£€æµ‹", "14.3 æ—¶åºåˆ†ç±»"],
                "15. ç§‘å­¦AI": ["15.1 è›‹ç™½è´¨ç»“æ„é¢„æµ‹", "15.2 ææ–™ç§‘å­¦", "15.3 æ°”å€™é¢„æµ‹", "15.4 æ•°å­¦å®šç†è¯æ˜", "15.5 åˆ†å­è®¾è®¡"]
            },
            "å››ï¼šå‰æ²¿ç ”ç©¶ä¸»é¢˜": {
                "16. è¿ç§»å­¦ä¹ ä¸é€‚åº”": ["16.1 è¿ç§»å­¦ä¹ åŸºç¡€", "16.2 åŸŸé€‚åº”", "16.3 åŸŸæ³›åŒ–", "16.4 æµ‹è¯•æ—¶é€‚åº”", "16.5 å‚æ•°é«˜æ•ˆå¾®è°ƒ"],
                "17. å°‘æ ·æœ¬ä¸é›¶æ ·æœ¬å­¦ä¹ ": ["17.1 å°‘æ ·æœ¬å­¦ä¹ ", "17.2 é›¶æ ·æœ¬å­¦ä¹ ", "17.3 å…ƒå­¦ä¹ "],
                "18. æŒç»­å­¦ä¹ ": ["18.1 ç¾éš¾æ€§é—å¿˜", "18.2 å¢é‡å­¦ä¹ ", "18.3 ç»ˆèº«å­¦ä¹ "],
                "19. çŸ¥è¯†è¡¨ç¤ºä¸æ¨ç†": ["19.1 çŸ¥è¯†å›¾è°±", "19.2 çŸ¥è¯†å›¾è°±è¡¥å…¨", "19.3 å¸¸è¯†æ¨ç†", "19.4 ç¥ç»ç¬¦å·ç³»ç»Ÿ", "19.5 é€»è¾‘æ¨ç†"],
                "20. å› æœæ¨æ–­": ["20.1 å› æœå‘ç°", "20.2 åäº‹å®æ¨ç†", "20.3 å› æœè¡¨ç¤ºå­¦ä¹ "],
                "21. ä¸–ç•Œæ¨¡å‹": ["21.1 ç¯å¢ƒå»ºæ¨¡", "21.2 è§†é¢‘é¢„æµ‹", "21.3 ç‰©ç†æ¨¡æ‹Ÿ"],
                "22. AI Agent": ["22.1 è¯­è¨€Agent", "22.2 å¤šAgentç³»ç»Ÿ", "22.3 å…·èº«Agent", "22.4 å·¥å…·ä½¿ç”¨"],
                "23. åŸºç¡€æ¨¡å‹": ["23.1 è§†è§‰åŸºç¡€æ¨¡å‹", "23.2 è¯­è¨€åŸºç¡€æ¨¡å‹", "23.3 å¤šæ¨¡æ€åŸºç¡€æ¨¡å‹", "23.4 åŸºç¡€æ¨¡å‹è¯„ä¼°"]
            },
            "äº”ï¼šAIå®‰å…¨ä¸ä¼˜åŒ–": {
                "24. æ¨¡å‹å‹ç¼©ä¸åŠ é€Ÿ": ["24.1 ç½‘ç»œå‰ªæ", "24.2 é‡åŒ–", "24.3 çŸ¥è¯†è’¸é¦", "24.4 è½»é‡çº§ç½‘ç»œè®¾è®¡", "24.5 ç¥ç»ç½‘ç»œåŠ é€Ÿå™¨"],
                "25. å¯¹æŠ—æ ·æœ¬ä¸é²æ£’æ€§": ["25.1 å¯¹æŠ—æ”»å‡»", "25.2 å¯¹æŠ—é˜²å¾¡", "25.3 é²æ£’æ€§åˆ†æ", "25.4 è®¤è¯é˜²å¾¡"],
                "26. å¯è§£é‡Šæ€§ä¸å¯è§†åŒ–": ["26.1 ç‰¹å¾å¯è§†åŒ–", "26.2 æ˜¾è‘—æ€§å›¾ä¸æ³¨æ„åŠ›åˆ†æ", "26.3 æ¨¡å‹è§£é‡Š", "26.4 å› æœè§£é‡Š"],
                "27. AIå®‰å…¨ä¸å¯¹é½": ["27.1 AIå®‰å…¨åŸºç¡€", "27.2 ä»·å€¼å¯¹é½", "27.3 äººç±»åé¦ˆå¼ºåŒ–å­¦ä¹ ", "27.4 çº¢é˜Ÿæµ‹è¯•", "27.5 å®‰å…¨è¯„ä¼°"],
                "28. AIä¼¦ç†ä¸å…¬å¹³æ€§": ["28.1 ç®—æ³•å…¬å¹³æ€§", "28.2 åè§æ£€æµ‹ä¸ç¼“è§£", "28.3 AIä¼¦ç†æ¡†æ¶", "28.4 å¯é—®è´£æ€§ä¸é€æ˜åº¦"],
                "29. éšç§ä¿æŠ¤": ["29.1 è”é‚¦å­¦ä¹ ", "29.2 å·®åˆ†éšç§", "29.3 å®‰å…¨å¤šæ–¹è®¡ç®—", "29.4 åŒæ€åŠ å¯†"]
            },
            "å…­ï¼šç³»ç»Ÿä¸å·¥ç¨‹": {
                "30. AIç³»ç»Ÿä¸åŸºç¡€è®¾æ–½": ["30.1 åˆ†å¸ƒå¼è®­ç»ƒ", "30.2 æ¨¡å‹å¹¶è¡Œ", "30.3 æ··åˆç²¾åº¦è®­ç»ƒ", "30.4 æ¢¯åº¦ç´¯ç§¯ä¸æ£€æŸ¥ç‚¹"],
                "31. AutoML": ["31.1 ç¥ç»æ¶æ„æœç´¢", "31.2 è¶…å‚æ•°ä¼˜åŒ–", "31.3 è‡ªåŠ¨ç‰¹å¾å·¥ç¨‹", "31.4 AutoMLç³»ç»Ÿ"],
                "32. MLOpsä¸éƒ¨ç½²": ["32.1 æ¨¡å‹éƒ¨ç½²", "32.2 æ¨¡å‹ç›‘æ§", "32.3 A/Bæµ‹è¯•", "32.4 æŒç»­é›†æˆ/æŒç»­éƒ¨ç½²"],
                "33. è¾¹ç¼˜AI": ["33.1 è¾¹ç¼˜è®¡ç®—ä¼˜åŒ–", "33.2 ç‰‡ä¸Šå­¦ä¹ ", "33.3 ç§»åŠ¨ç«¯éƒ¨ç½²"]
            },
            "ä¸ƒï¼šäº¤å‰ä¸æ–°å…´é¢†åŸŸ": {
                "34. å…·èº«AI": ["34.1 è§†è§‰å¯¼èˆª", "34.2 å…·èº«é—®ç­”", "34.3 äº¤äº’å¼å­¦ä¹ "],
                "35. ç¤¾äº¤AI": ["35.1 æƒ…æ„Ÿè®¡ç®—", "35.2 ç¤¾äº¤æœºå™¨äºº", "35.3 äººæœºäº¤äº’"],
                "36. åˆ›æ„AI": ["36.1 è‰ºæœ¯ç”Ÿæˆ", "36.2 éŸ³ä¹ç”Ÿæˆ", "36.3 è§†é¢‘ç”Ÿæˆ", "36.4 3Då†…å®¹ç”Ÿæˆ"],
                "37. ç¥ç»ç§‘å­¦å¯å‘çš„AI": ["37.1 è„‰å†²ç¥ç»ç½‘ç»œ", "37.2 è®°å¿†ç½‘ç»œ", "37.3 è®¤çŸ¥æ¶æ„"],
                "38. é‡å­æœºå™¨å­¦ä¹ ": ["38.1 é‡å­ç¥ç»ç½‘ç»œ", "38.2 é‡å­ç®—æ³•", "38.3 é‡å­-ç»å…¸æ··åˆç³»ç»Ÿ"]
            }
        };

        // State management
        let currentLevel = [];
        let papers = {};
        let currentSubcategory = null;

        // Initialize
        // Initialize
        async function init() {
            try {
                if (window.storage) {
                    const stored = await window.storage.get('papers');
                    if (stored && stored.value) {
                        papers = JSON.parse(stored.value);
                    }
                } else {
                    const stored = localStorage.getItem('papers');
                    if (stored) {
                        papers = JSON.parse(stored);
                    }
                }
            } catch (error) {
                console.log('No stored data or error loading:', error);
                papers = {};
            }
            renderLevel1();
        }

        // Save papers
        async function savePapers() {
            try {
                if (window.storage) {
                    const result = await window.storage.set('papers', JSON.stringify(papers));
                    if (result) {
                        return true;
                    } else {
                        alert('ä¿å­˜å¤±è´¥ï¼Œè¯·ç¨åé‡è¯•');
                        return false;
                    }
                } else {
                    localStorage.setItem('papers', JSON.stringify(papers));
                    return true;
                }
            } catch (error) {
                console.error('Error saving papers:', error);
                alert('ä¿å­˜å¤±è´¥ï¼š' + error.message);
                return false;
            }
        }

        // Render Level 1 (Parts)
        function renderLevel1() {
            currentLevel = [];
            updateBreadcrumb();
            
            // æ¢å¤ header æŒ‰é’®ä¸ºå¯¼å‡º/å¯¼å…¥
            const headerButtonGroup = document.querySelector('.header .btn-group');
            headerButtonGroup.innerHTML = `
                <button class="btn btn-secondary" onclick="exportData()">ğŸ“¥ å¯¼å‡º</button>
                <button class="btn btn-secondary" onclick="importData()">ğŸ“¤ å¯¼å…¥</button>
            `;
            
            const content = document.getElementById('content');
            content.innerHTML = `
                <div class="level-grid">
                    ${Object.keys(structure).map(part => {
                        const count = Object.keys(structure[part]).reduce((sum, chapter) => 
                            sum + structure[part][chapter].length, 0);
                        return `
                            <div class="level-card" onclick="renderLevel2('${part}')">
                                <h3>${part}</h3>
                                <div class="count">${count} ä¸ªå­ç±»åˆ«</div>
                            </div>
                        `;
                    }).join('')}
                </div>
            `;
        }

        // Render Level 2 (Chapters and Subcategories)
        function renderLevel2(part) {
            currentLevel = [part];
            updateBreadcrumb();
            
            // æ¢å¤ header æŒ‰é’®ä¸ºå¯¼å‡º/å¯¼å…¥
            const headerButtonGroup = document.querySelector('.header .btn-group');
            headerButtonGroup.innerHTML = `
                <button class="btn btn-secondary" onclick="exportData()">ğŸ“¥ å¯¼å‡º</button>
                <button class="btn btn-secondary" onclick="importData()">ğŸ“¤ å¯¼å…¥</button>
            `;
            
            const chapters = structure[part];
            const content = document.getElementById('content');
            
            let html = '<div class="level-grid">';
            for (const [chapter, subcategories] of Object.entries(chapters)) {
                for (const subcategory of subcategories) {
                    const paperCount = papers[subcategory] ? papers[subcategory].length : 0;
                    html += `
                        <div class="level-card" onclick="renderPaperList('${part}', '${chapter}', '${subcategory}')">
                            <h3>${subcategory}</h3>
                            <div class="count">${paperCount} ç¯‡è®ºæ–‡</div>
                        </div>
                    `;
                }
            }
            html += '</div>';
            
            content.innerHTML = html;
        }

        // Render Paper List
        function renderPaperList(part, chapter, subcategory) {
            currentLevel = [part, chapter, subcategory];
            currentSubcategory = subcategory;
            updateBreadcrumb();
            
            // æ¢å¤ header æŒ‰é’®ä¸ºå¯¼å‡º/å¯¼å…¥
            const headerButtonGroup = document.querySelector('.header .btn-group');
            headerButtonGroup.innerHTML = `
                <button class="btn btn-secondary" onclick="exportData()">ğŸ“¥ å¯¼å‡º</button>
                <button class="btn btn-secondary" onclick="importData()">ğŸ“¤ å¯¼å…¥</button>
            `;
            
            const paperList = papers[subcategory] || [];
            const content = document.getElementById('content');
            
            let html = `
                <div class="action-bar">
                    <div class="search-box">
                        <input type="text" placeholder="æœç´¢è®ºæ–‡..." id="searchInput" oninput="filterPapers()">
                    </div>
                    <button class="btn btn-primary" onclick="openAddPaperModal()">+ æ·»åŠ è®ºæ–‡</button>
                </div>
            `;
            
            if (paperList.length === 0) {
                html += `
                    <div class="empty-state">
                        <div class="empty-state-icon">ğŸ“š</div>
                        <div class="empty-state-text">è¿˜æ²¡æœ‰æ·»åŠ è®ºæ–‡ç¬”è®°</div>
                        <div class="empty-state-subtext">ç‚¹å‡»ä¸Šæ–¹æŒ‰é’®å¼€å§‹æ·»åŠ æ‚¨çš„ç¬¬ä¸€ç¯‡è®ºæ–‡ç¬”è®°</div>
                    </div>
                `;
            } else {
                html += '<div id="paperListContainer">';
                paperList.forEach((paper, index) => {
                    html += `
                        <div class="paper-item" data-title="${paper.title.toLowerCase()}" data-authors="${paper.authors.toLowerCase()}">
                            <div class="paper-header" onclick="renderPaperDetail(${index})">
                                <div class="paper-number">${index + 1}</div>
                                <div class="paper-info">
                                    <div class="paper-title">${paper.title}</div>
                                    <div class="paper-meta">${paper.authors} â€¢ ${paper.year}</div>
                                </div>
                            </div>
                            <div class="paper-summary" onclick="renderPaperDetail(${index})">
                                ${paper.summary}
                            </div>
                        </div>
                    `;
                });
                html += '</div>';
            }
            
            content.innerHTML = html;
        }

        // Filter papers
        function filterPapers() {
            const searchTerm = document.getElementById('searchInput').value.toLowerCase();
            const paperItems = document.querySelectorAll('.paper-item');
            
            paperItems.forEach(item => {
                const title = item.getAttribute('data-title');
                const authors = item.getAttribute('data-authors');
                
                if (title.includes(searchTerm) || authors.includes(searchTerm)) {
                    item.style.display = 'block';
                } else {
                    item.style.display = 'none';
                }
            });
        }

        // Render Paper Detail
        function renderPaperDetail(index) {
            const paper = papers[currentSubcategory][index];
            updateBreadcrumb(paper.title);
            
            // å…ˆæ›´æ–° header ä¸­çš„æŒ‰é’®åŒºåŸŸ
            const headerButtonGroup = document.querySelector('.header .btn-group');
            headerButtonGroup.innerHTML = `
                <div class="detail-meta-item">
                    <span>ğŸ‘¥</span> ${paper.authors}
                </div>
                <div class="detail-meta-item">
                    <span>ğŸ“…</span> ${paper.year}
                </div>
                ${paper.url ? `<a href="${paper.url}" target="_blank" class="link-button">ğŸ”— åŸæ–‡é“¾æ¥</a>` : ''}
                <button class="btn btn-secondary" onclick="openEditMetadataModal(${index})">ğŸ“ ç¼–è¾‘ä¿¡æ¯</button>
                <button class="btn btn-secondary" onclick="openEditNotesModal(${index})">âœï¸ ç¼–è¾‘ç¬”è®°</button>
                <button class="btn btn-danger" onclick="deletePaper(${index})">ğŸ—‘ï¸ åˆ é™¤</button>
            `;

            const content = document.getElementById('content');
            content.innerHTML = `
                <div class="paper-detail">
                    <div class="detail-content" id="noteContent">
                        ${parseMarkdown(paper.notes || 'æš‚æ— ç¬”è®°å†…å®¹')}
                    </div>
                </div>
            `;
            
            // Render MathJax
            if (window.MathJax && window.MathJax.typesetPromise) {
                setTimeout(() => {
                    MathJax.typesetPromise([document.getElementById('noteContent')]).catch((err) => console.log('MathJax error:', err));
                }, 100);
            }
        }

        // Simple Markdown parser
        function parseMarkdown(text) {
            if (!text) return '';
            
            // ä¿æŠ¤å…¬å¼ï¼šå…ˆæ›¿æ¢ä¸ºå ä½ç¬¦
            const mathBlocks = [];
            const mathInlines = [];
            
            // ä¿æŠ¤å—çº§å…¬å¼ $$...$$
            text = text.replace(/\$\$([\s\S]*?)\$\$/g, (match, formula) => {
                mathBlocks.push(match);
                return `__MATH_BLOCK_${mathBlocks.length - 1}__`;
            });
            
            // ä¿æŠ¤è¡Œå†…å…¬å¼ $...$
            text = text.replace(/\$([^\$\n]+?)\$/g, (match, formula) => {
                mathInlines.push(match);
                return `__MATH_INLINE_${mathInlines.length - 1}__`;
            });
            
            // Headers
            text = text.replace(/^### (.*$)/gim, '<h3>$1</h3>');
            text = text.replace(/^## (.*$)/gim, '<h2>$1</h2>');
            
            // Code blocks (åœ¨ bold/italic ä¹‹å‰å¤„ç†)
            text = text.replace(/```(.*?)```/gs, '<pre><code>$1</code></pre>');
            
            // Inline code (åœ¨ bold/italic ä¹‹å‰å¤„ç†)
            text = text.replace(/`(.*?)`/g, '<code>$1</code>');
            
            // Bold
            text = text.replace(/\*\*(.*?)\*\*/g, '<strong>$1</strong>');
            
            // Italic
            text = text.replace(/\*(.*?)\*/g, '<em>$1</em>');
            
            // Lists
            text = text.replace(/^\- (.*$)/gim, '<li>$1</li>');
            text = text.replace(/(<li>.*<\/li>)/s, '<ul>$1</ul>');
            
            // Paragraphs
            text = text.split('\n\n').map(para => {
                if (!para.startsWith('<') && !para.startsWith('__MATH_') && para.trim()) {
                    return '<p>' + para + '</p>';
                }
                return para;
            }).join('\n');
            
            // æ¢å¤å…¬å¼
            mathBlocks.forEach((math, index) => {
                text = text.replace(`__MATH_BLOCK_${index}__`, math);
            });
            
            mathInlines.forEach((math, index) => {
                text = text.replace(`__MATH_INLINE_${index}__`, math);
            });
            
            return text;
        }

        // Delete paper
        function deletePaper(index) {
            if (confirm('ç¡®å®šè¦åˆ é™¤è¿™ç¯‡è®ºæ–‡ç¬”è®°å—ï¼Ÿ')) {
                papers[currentSubcategory].splice(index, 1);
                savePapers();
                currentLevel.pop();
                renderPaperList(currentLevel[0], currentLevel[1], currentSubcategory);
            }
        }

        // Update breadcrumb
        function updateBreadcrumb(paperTitle = null) {
            const breadcrumb = document.getElementById('breadcrumb');
            
            if (currentLevel.length === 0) {
                breadcrumb.innerHTML = '';
                document.getElementById('pageTitle').textContent = 'PaperReading';
                return;
            }
            
            let html = '<span class="breadcrumb-item" onclick="renderLevel1()">é¦–é¡µ</span>';
            
            currentLevel.forEach((level, index) => {
                html += '<span class="breadcrumb-separator">â€º</span>';
                if (index === 0) {
                    html += `<span class="breadcrumb-item" onclick="renderLevel2('${level}')">${level}</span>`;
                } else if (index === 1) {
                    html += `<span class="breadcrumb-item" onclick="renderLevel2('${currentLevel[0]}')">${level}</span>`;
                } else if (index === 2) {
                    html += `<span class="breadcrumb-item" onclick="renderPaperList('${currentLevel[0]}', '${currentLevel[1]}', '${currentLevel[2]}')">${level}</span>`;
                } else {
                    html += `<span class="breadcrumb-item">${level}</span>`;
                }
            });
            
            breadcrumb.innerHTML = html;
            document.getElementById('pageTitle').textContent = paperTitle || currentLevel[currentLevel.length - 1];
        }

        // Modal functions
        function openAddPaperModal() {
            document.getElementById('addPaperModal').classList.add('active');
            document.getElementById('addPaperForm').reset();
            showSidebars();
        }

        function openEditMetadataModal(index) {
            const paper = papers[currentSubcategory][index];
            document.getElementById('addPaperModal').classList.add('active');
            document.getElementById('paperTitle').value = paper.title;
            document.getElementById('paperAuthors').value = paper.authors;
            document.getElementById('paperYear').value = paper.year;
            document.getElementById('paperUrl').value = paper.url || '';
            document.getElementById('paperSummary').value = paper.summary;
            document.getElementById('paperNotes').value = paper.notes || '';
            
            // éšè—ç¬”è®°å­—æ®µ
            document.getElementById('notesGroup').style.display = 'none';
            
            // è®¾ç½®ç¼–è¾‘æ¨¡å¼
            document.getElementById('addPaperForm').dataset.editIndex = index;
            document.getElementById('addPaperForm').dataset.editType = 'metadata';
            document.querySelector('.modal-header').textContent = 'ç¼–è¾‘è®ºæ–‡ä¿¡æ¯';
        }

        // Insert text at cursor position in textarea
        function insertText(text) {
            const textarea = document.getElementById('paperNotes');
            const start = textarea.selectionStart;
            const end = textarea.selectionEnd;
            const currentValue = textarea.value;
            
            textarea.value = currentValue.substring(0, start) + text + currentValue.substring(end);
            
            // Set cursor position
            const newPos = start + text.length;
            textarea.setSelectionRange(newPos, newPos);
            textarea.focus();
        }

        // Toggle section collapse
        function toggleSection(label) {
            const content = label.nextElementSibling;
            const isCollapsed = content.classList.contains('collapsed');
            
            if (isCollapsed) {
                content.classList.remove('collapsed');
                label.classList.remove('collapsed');
            } else {
                content.classList.add('collapsed');
                label.classList.add('collapsed');
            }
        }

        // Show/hide sidebars
        function showSidebars() {
            document.getElementById('leftSidebar').classList.add('active');
            document.getElementById('rightSidebar').classList.add('active');
            document.body.classList.add('sidebars-active');
        }

        function hideSidebars() {
            document.getElementById('leftSidebar').classList.remove('active');
            document.getElementById('rightSidebar').classList.remove('active');
            document.body.classList.remove('sidebars-active');
        }

        function openEditNotesModal(index) {
            const paper = papers[currentSubcategory][index];
            document.getElementById('addPaperModal').classList.add('active');
            document.getElementById('paperTitle').value = paper.title;
            document.getElementById('paperAuthors').value = paper.authors;
            document.getElementById('paperYear').value = paper.year;
            document.getElementById('paperUrl').value = paper.url || '';
            document.getElementById('paperSummary').value = paper.summary;
            document.getElementById('paperNotes').value = paper.notes || '';
            
            // éšè—å…ƒæ•°æ®å­—æ®µ
            document.getElementById('titleGroup').style.display = 'none';
            document.getElementById('authorsGroup').style.display = 'none';
            document.getElementById('yearGroup').style.display = 'none';
            document.getElementById('urlGroup').style.display = 'none';
            document.getElementById('summaryGroup').style.display = 'none';
            
            // è®¾ç½®ç¼–è¾‘æ¨¡å¼
            document.getElementById('addPaperForm').dataset.editIndex = index;
            document.getElementById('addPaperForm').dataset.editType = 'notes';
            document.querySelector('.modal-header').style.display = 'none';

            // æ·»åŠ å…¨å±æ ·å¼
            document.querySelector('.modal-content').classList.add('fullscreen');
            document.getElementById('paperNotes').classList.add('fullscreen-textarea');

            showSidebars();
        }

        function closeModal() {
            document.getElementById('addPaperModal').classList.remove('active');
            document.getElementById('addPaperForm').reset();
            // ç§»é™¤å…¨å±æ ·å¼
            document.querySelector('.modal-content').classList.remove('fullscreen');
            document.getElementById('paperNotes').classList.remove('fullscreen-textarea');

            delete document.getElementById('addPaperForm').dataset.editIndex;
            delete document.getElementById('addPaperForm').dataset.editType;
            
            // æ¢å¤æ‰€æœ‰å­—æ®µçš„æ˜¾ç¤º
            document.getElementById('titleGroup').style.display = 'block';
            document.getElementById('authorsGroup').style.display = 'block';
            document.getElementById('yearGroup').style.display = 'block';
            document.getElementById('urlGroup').style.display = 'block';
            document.getElementById('summaryGroup').style.display = 'block';
            document.getElementById('notesGroup').style.display = 'block';
            
            document.querySelector('.modal-header').textContent = 'æ·»åŠ è®ºæ–‡ç¬”è®°';
            document.querySelector('.modal-header').style.display = 'block';

            hideSidebars();
        }

        // Add paper
        document.getElementById('addPaperForm').addEventListener('submit', async function(e) {
            e.preventDefault();
            
            const paper = {
                title: document.getElementById('paperTitle').value,
                authors: document.getElementById('paperAuthors').value,
                year: parseInt(document.getElementById('paperYear').value),
                url: document.getElementById('paperUrl').value,
                summary: document.getElementById('paperSummary').value,
                notes: document.getElementById('paperNotes').value
            };
            
            const editIndex = this.dataset.editIndex;
            
            if (editIndex !== undefined) {
                // ç¼–è¾‘æ¨¡å¼
                const oldPaper = {...papers[currentSubcategory][editIndex]};
                papers[currentSubcategory][editIndex] = paper;
                const saved = await savePapers();
                
                if (saved !== false) {
                    closeModal();
                    renderPaperDetail(editIndex);
                } else {
                    papers[currentSubcategory][editIndex] = oldPaper; // å›æ»š
                }
            } else {
                // æ–°å¢æ¨¡å¼
                if (!papers[currentSubcategory]) {
                    papers[currentSubcategory] = [];
                }
                
                papers[currentSubcategory].push(paper);
                const saved = await savePapers();

                if (saved !== false) {
                    closeModal();
                    renderPaperList(currentLevel[0], currentLevel[1], currentSubcategory);
                } else {
                    papers[currentSubcategory].pop(); // å›æ»š
                }
            }
        });

        // Export data
        function exportData() {
            const dataStr = JSON.stringify(papers, null, 2);
            const dataBlob = new Blob([dataStr], { type: 'application/json' });
            const url = URL.createObjectURL(dataBlob);
            
            const link = document.createElement('a');
            link.href = url;
            link.download = `papers_${new Date().toISOString().split('T')[0]}.json`;
            link.click();
            
            URL.revokeObjectURL(url);
        }

        // Import data
        function importData() {
            const input = document.getElementById('importFile');
            input.click();
        }

        document.getElementById('importFile').addEventListener('change', async function(e) {
            const file = e.target.files[0];
            if (!file) return;
            
            const reader = new FileReader();
            reader.onload = async function(event) {
                try {
                    const importedData = JSON.parse(event.target.result);
                    
                    if (confirm('å¯¼å…¥å°†è¦†ç›–ç°æœ‰æ•°æ®ï¼Œæ˜¯å¦ç»§ç»­ï¼Ÿ')) {
                        papers = importedData;
                        await savePapers();
                        alert('å¯¼å…¥æˆåŠŸï¼');
                        renderLevel1();
                    }
                } catch (error) {
                    alert('å¯¼å…¥å¤±è´¥ï¼šæ–‡ä»¶æ ¼å¼é”™è¯¯');
                    console.error(error);
                }
            };
            reader.readAsText(file);
            
            // Reset input
            e.target.value = '';
        });

        // Close modal on background click
        document.getElementById('addPaperModal').addEventListener('click', function(e) {
            if (e.target === this) {
                closeModal();
            }
        });

        // Initialize app
        init();
    </script>
</body>
</html>